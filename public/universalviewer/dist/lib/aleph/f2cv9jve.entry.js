const e=window.aleph.h;import{a as t,b as s}from"./chunk-a3ddc7e5.js";var n,i,a,r,o,l;!function(e){e[e.Backspace=8]="Backspace",e[e.Tab=9]="Tab",e[e.Enter=13]="Enter",e[e.Shift=16]="Shift",e[e.Ctrl=17]="Ctrl",e[e.Alt=18]="Alt",e[e.PauseBreak=19]="PauseBreak",e[e.CapsLock=20]="CapsLock",e[e.Escape=27]="Escape",e[e.Spacebar=32]="Spacebar",e[e.PageUp=33]="PageUp",e[e.PageDown=34]="PageDown",e[e.End=35]="End",e[e.Home=36]="Home",e[e.LeftArrow=37]="LeftArrow",e[e.UpArrow=38]="UpArrow",e[e.RightArrow=39]="RightArrow",e[e.DownArrow=40]="DownArrow",e[e.PrintScrn=44]="PrintScrn",e[e.Insert=45]="Insert",e[e.Delete=46]="Delete",e[e.Zero=48]="Zero",e[e.One=49]="One",e[e.Two=50]="Two",e[e.Three=51]="Three",e[e.Four=52]="Four",e[e.Five=53]="Five",e[e.Six=54]="Six",e[e.Seven=55]="Seven",e[e.Eight=56]="Eight",e[e.Nine=57]="Nine",e[e.a=65]="a",e[e.b=66]="b",e[e.c=67]="c",e[e.d=68]="d",e[e.e=69]="e",e[e.f=70]="f",e[e.g=71]="g",e[e.h=72]="h",e[e.i=73]="i",e[e.j=74]="j",e[e.k=75]="k",e[e.l=76]="l",e[e.m=77]="m",e[e.n=78]="n",e[e.o=79]="o",e[e.p=80]="p",e[e.q=81]="q",e[e.r=82]="r",e[e.s=83]="s",e[e.t=84]="t",e[e.u=85]="u",e[e.v=86]="v",e[e.w=87]="w",e[e.x=88]="x",e[e.y=89]="y",e[e.z=90]="z",e[e.LeftWindowKey=91]="LeftWindowKey",e[e.RightWindowKey=92]="RightWindowKey",e[e.SelectKey=93]="SelectKey",e[e.Numpad0=96]="Numpad0",e[e.Numpad1=97]="Numpad1",e[e.Numpad2=98]="Numpad2",e[e.Numpad3=99]="Numpad3",e[e.Numpad4=100]="Numpad4",e[e.Numpad5=101]="Numpad5",e[e.Numpad6=102]="Numpad6",e[e.Numpad7=103]="Numpad7",e[e.Numpad8=104]="Numpad8",e[e.Numpad9=105]="Numpad9",e[e.Multiply=106]="Multiply",e[e.NumpadPlus=107]="NumpadPlus",e[e.NumpadMinus=109]="NumpadMinus",e[e.DecimalPoint=110]="DecimalPoint",e[e.Divide=111]="Divide",e[e.F1=112]="F1",e[e.F2=113]="F2",e[e.F3=114]="F3",e[e.F4=115]="F4",e[e.F5=116]="F5",e[e.F6=117]="F6",e[e.F7=118]="F7",e[e.F8=119]="F8",e[e.F9=120]="F9",e[e.F10=121]="F10",e[e.F11=122]="F11",e[e.F12=123]="F12",e[e.NumLock=144]="NumLock",e[e.ScrollLock=145]="ScrollLock",e[e.Semicolon=186]="Semicolon",e[e.Equals=187]="Equals",e[e.Comma=188]="Comma",e[e.LessThan=188]="LessThan",e[e.Dash=189]="Dash",e[e.Period=190]="Period",e[e.GreaterThan=190]="GreaterThan",e[e.ForwardSlash=191]="ForwardSlash",e[e.QuestionMark=191]="QuestionMark",e[e.GraveAccent=192]="GraveAccent",e[e.Tilde=192]="Tilde",e[e.OpenCurlyBracket=219]="OpenCurlyBracket",e[e.OpenSquareBracket=219]="OpenSquareBracket",e[e.BackSlash=220]="BackSlash",e[e.VerticalPipe=220]="VerticalPipe",e[e.CloseCurlyBracket=221]="CloseCurlyBracket",e[e.CloseSquareBracket=221]="CloseSquareBracket",e[e.Quote=222]="Quote",e[e.CommandFF=224]="CommandFF"}(n||(n={})),function(e){e[e.Backspace=8]="Backspace",e[e.Enter=13]="Enter",e[e.Spacebar=32]="Spacebar",e[e.Hash=35]="Hash",e[e.GraveAccent=39]="GraveAccent",e[e.DoubleQuote=34]="DoubleQuote",e[e.Asterisk=42]="Asterisk",e[e.Plus=43]="Plus",e[e.Comma=44]="Comma",e[e.Minus=45]="Minus",e[e.Period=46]="Period",e[e.ForwardSlash=47]="ForwardSlash",e[e.Zero=48]="Zero",e[e.One=49]="One",e[e.Two=50]="Two",e[e.Three=51]="Three",e[e.Four=52]="Four",e[e.Five=53]="Five",e[e.Six=54]="Six",e[e.Seven=55]="Seven",e[e.Eight=56]="Eight",e[e.Nine=57]="Nine",e[e.Colon=58]="Colon",e[e.Semicolon=59]="Semicolon",e[e.LessThan=60]="LessThan",e[e.Equals=61]="Equals",e[e.GreaterThan=62]="GreaterThan",e[e.QuestionMark=63]="QuestionMark",e[e.At=64]="At",e[e.OpenSquareBracket=91]="OpenSquareBracket",e[e.BackSlash=92]="BackSlash",e[e.CloseSquareBracket=93]="CloseSquareBracket",e[e.a=97]="a",e[e.b=98]="b",e[e.c=99]="c",e[e.d=100]="d",e[e.e=101]="e",e[e.f=102]="f",e[e.g=103]="g",e[e.h=104]="h",e[e.i=105]="i",e[e.j=106]="j",e[e.k=107]="k",e[e.l=108]="l",e[e.m=109]="m",e[e.n=110]="n",e[e.o=111]="o",e[e.p=112]="p",e[e.q=113]="q",e[e.r=114]="r",e[e.s=115]="s",e[e.t=116]="t",e[e.u=117]="u",e[e.v=118]="v",e[e.w=119]="w",e[e.x=120]="x",e[e.y=121]="y",e[e.z=122]="z",e[e.OpenCurlyBracket=123]="OpenCurlyBracket",e[e.VerticalPipe=124]="VerticalPipe",e[e.CloseCurlyBracket=125]="CloseCurlyBracket",e[e.Tilde=126]="Tilde"}(i||(i={}));class d{}d.fontSizeSmall=.75,d.fontSizeMedium=1.5,d.fontSizeLarge=2.5,d.movedEventName="-moved",d.titleIdName="-title",d.controllerName="-controller",d.nodeSizeRatio=75,d.backboardSize=10,d.zoomFactor=2.5,d.minLoadingMS=500,d.topLayerRenderOrder=999,d.angleUnitsDecimalPlaces=3,d.edgeSize=.005,d.stackSpaceMultiplier={x:10,y:10,z:10},d.maxAnimationSteps=50,d.minFrameMS=15,d.minTimeForThrottle=5*d.minFrameMS,d.buttonColors={active:"#f50057",hover:"#f50057",up:"#00b0ff"},d.colorValues={red:"#f50057",blue:"#00b0ff",black:"#000000",white:"#ffffff",yellow:"#ffeb3b",green:"#76ff03",lightRed:"#f77777"},d.lightValues={ambientLightColor:13684944,ambientLightIntensity:1,directionalLight1Color:16777215,directionalLight1Intensity:.75,directionalLight2Color:10584,directionalLight2Intensity:.5},d.cameraValues={near:.05,far:1e4,fov:45,maxPolarAngle:165,rotateSpeed:.5,zoomSpeed:1,dampingFactor:.25,minDistance:0};class c{static primitiveExists(e){return!!AFRAME.primitives[e]}static geometryExists(e){return!!AFRAME.geometries[e]}static componentExists(e){return!!AFRAME.components[e]}static registerPrimitive(e,t){this.primitiveExists(e)||AFRAME.registerPrimitive(e,t)}static registerGeometry(e,t){this.geometryExists(e)||AFRAME.registerGeometry(e,t)}static registerComponent(e,t){this.componentExists(e)||AFRAME.registerComponent(e,t)}}class h{static isWebGL2Available(){try{const e=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!e.getContext("webgl2"))}catch(e){return!1}}static enableOrbitControls(e,t){e.setAttribute("al-orbit-control",`enabled: ${t}`)}static waitOneFrame(e){window.setTimeout(()=>{e()},d.minFrameMS)}static objectToVector3(e){let t=new THREE.Vector3;return t.x=e.x,t.y=e.y,t.z=e.z,t}static worldToScreen(e,t,s){const n=e.clone();return n.project(t),n.x=Math.round((n.x+1)*s.offsetWidth/2),n.y=Math.round((1-n.y)*s.offsetHeight/2),n.z=0,n}static vector3ToString(e){return e.toArray().join(" ")}static stringToVector3(e){let t=e.split(" "),s=new THREE.Vector3;return s.x=Number(t[0]),s.y=Number(t[1]),s.z=Number(t[2]),s}static slerp(e,t,s){const n=s,i=e,a=t;let r=i.angleTo(a);if(r){r=THREE.Math.clamp(r,-.99,.99);const e=Math.sin(1-n)*r,t=Math.sin(n*r),s=Math.sin(r),o=e/s,l=t/s,d=i.clone().multiplyScalar(o),c=a.clone().multiplyScalar(l);return d.add(c)}return null}static easeInOutCubic(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1}static getSlerpPath(e,t,s,n){let i=[];const a=e.position.clone().addScalar(Number.EPSILON),r=e.target.clone().addScalar(Number.EPSILON),o=t.position.clone().addScalar(Number.EPSILON),l=t.target.clone().addScalar(Number.EPSILON);for(let e=0;e<=d.maxAnimationSteps;e++){let t=this.easeInOutCubic(e/d.maxAnimationSteps);i.push({position:s?h.slerp(a.clone(),o.clone(),t):o,target:n?h.slerp(r.clone(),l.clone(),t):l})}return i}}class p{static _traceDataRay(e,t,s,n,i,a,r,o,l,d){let c=0,h=Math.floor,p=0|h(t),u=0|h(s),E=0|h(n),m=i>0?1:-1,g=a>0?1:-1,b=r>0?1:-1,_=Math.abs(1/i),y=Math.abs(1/a),S=Math.abs(1/r),v=_<1/0?_*(m>0?p+1-t:t-p):1/0,T=y<1/0?y*(g>0?u+1-s:s-u):1/0,f=S<1/0?S*(b>0?E+1-n:n-E):1/0,w=e.windowCenter-.5*e.windowWidth,O=-1;for(;c<=o;){let o,h=new THREE.Vector3(p,u,E),A=AMI.CoreUtils.worldToData(e.stack.lps2IJK,h),P=AMI.CoreUtils.getPixelData(e.stack,A);if(o=null!==P&&P>w?1:0)return l&&(l.x=t+c*i,l.y=s+c*a,l.z=n+c*r),d&&(d.x=d.y=d.z=0,0===O&&(d.x=-m),1===O&&(d.y=-g),2===O&&(d.z=-b)),o;v<T?v<f?(p+=m,c=v,v+=_,O=0):(E+=b,c=f,f+=S,O=2):T<f?(u+=g,c=T,T+=y,O=1):(E+=b,c=f,f+=S,O=2)}return l&&(l.x=t+c*i,l.y=s+c*a,l.z=n+c*r),d&&(d.x=d.y=d.z=0),0}static volumeRay(e,t,s,n,i,a){let r=+t.x,o=+t.y,l=+t.z,d=+s.x,c=+s.y,h=+s.z,p=Math.sqrt(d*d+c*c+h*h);if(0===p)throw new Error("Can't raycast along a zero vector");return this._traceDataRay(e,r,o,l,d/=p,c/=p,h/=p,n=void 0===n?64:+n,i,a)}static toAframeSpace(e){return e.divide(h.objectToVector3(d.stackSpaceMultiplier))}}class u{static debounce(e,t){return t=t||100,function(){if(!e.debouncing){const t=Array.prototype.slice.apply(arguments);e.lastReturnVal=e.apply(this,t),e.debouncing=!0}return clearTimeout(e.debounceTimeout),e.debounceTimeout=setTimeout(function(){e.debouncing=!1},t),e.lastReturnVal}}}class E{static addCssUnits(e){return this.cssUnits.some(t=>e.includes(t))||(e+="px"),e}static getFileExtension(e){return e.substring(e.lastIndexOf(".")+1)}static getGeometryCenter(e){let t;return(t=e instanceof THREE.BufferGeometry?(new THREE.Geometry).fromBufferGeometry(e):e).computeBoundingSphere(),t.boundingSphere.center}static getCameraStateFromMesh(e){let t,s,n;if(e){const i=e.geometry;return t=this.getGeometryCenter(i),n=d.zoomFactor*i.boundingSphere.radius/Math.tan(d.cameraValues.fov*Math.PI/180),(s=new THREE.Vector3).copy(t),s.z+=n,{target:t,position:s}}return null}static getCameraPositionFromNode(e,t,s){if(!e)return null;let n=new THREE.Vector3;n.copy(h.stringToVector3(e.position));let i=n.clone().sub(s.clone()).normalize(),a=new THREE.Vector3;return a.copy(n),a.add(i.clone().multiplyScalar(t*d.zoomFactor)),a}static getBoundingBox(e){return(new THREE.Box3).setFromObject(e)}}E.cssUnits=["%","ch","cm","em","ex","in","mm","pc","pt","px","rem","vh","vmax","vmin","vw"];class m{static setup(e){const t=e.scene||e.scenes[0];let s;t instanceof THREE.Mesh?s=t:t.children.forEach(e=>{e instanceof THREE.Mesh&&(s=e)});let n=s.geometry;n instanceof THREE.BufferGeometry&&(n=(new THREE.Geometry).fromBufferGeometry(s.geometry));let i=n.vertices.reduce((e,t)=>new THREE.Vector3(Math.min(e.length(),t.length()),0,0)).x;return{mesh:s,maxDist:i}}}class g{}g.SELECTED="al-graph-selected",g.POINTER_OVER="al-graph-pointer-over",g.POINTER_OUT="al-graph-pointer-out",g.DRAGGED="al-graph-dragged",g.POINTER_DOWN="al-graph-pointer-down",g.POINTER_UP="al-graph-pointer-up";class b{static getEntryWithHighestId(e){return e.size?Math.max.apply(Math,Array.from(e).map(([e])=>Number(e.split("-")[1]))):-1}static getNextId(e,t){return e+"-"+Number(this.getEntryWithHighestId(t)+1)}}class _{static getHaloMaterial(e=.5,t=.5,s=.5,n=.1,i=.5){return new THREE.ShaderMaterial({uniforms:{r:{value:e},g:{value:t},b:{value:s},a:{value:n},c:{value:i}},vertexShader:this.haloVertex,fragmentShader:this.haloFragment,side:THREE.BackSide,blending:THREE.AdditiveBlending,transparent:!0,depthTest:!1})}}_.haloVertex="\n    varying vec3 vNormal;\n\n    void main()\n    {\n        vNormal = normalize( normalMatrix * normal );\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    }\n  ",_.haloFragment="\n    varying vec3 vNormal;\n    uniform float r;\n    uniform float g;\n    uniform float b;\n    uniform float a;\n    uniform float c;\n\n    void main()\n    {\n        float intensity = pow( c - dot( vNormal, vec3( 0.0, 0.0, 1.0 ) ), 4.0 );\n        gl_FragColor = vec4(r, g, b, a) * intensity;\n    }\n  ",function(e){e.NODE="node",e.EDGE="edge",e.ANGLE="angle"}(a||(a={})),function(e){e.GLTF="gltf",e.GLB="glb"}(r||(r={})),function(e){e.LOCK="LOCK",e.MESH="MESH"}(o||(o={}));class y{static get Object(){return{schema:{selected:{type:"boolean"},edge0Pos:{type:"vec3"},edge1Pos:{type:"vec3"},position:{type:"vec3"},length:{type:"number"},radius:{type:"number"},angle:{type:"number"}},bindListeners(){this.pointerDown=this.pointerDown.bind(this),this.pointerOver=this.pointerOver.bind(this),this.pointerOut=this.pointerOut.bind(this),this.createMesh=this.createMesh.bind(this)},addListeners(){this.el.addEventListener("mousedown",this.pointerDown,{capture:!1,once:!1,passive:!0}),this.el.addEventListener("raycaster-intersected",this.pointerOver,{capture:!1,once:!1,passive:!0}),this.el.addEventListener("raycaster-intersected-cleared",this.pointerOut,{capture:!1,once:!1,passive:!0})},removeListeners(){this.el.removeEventListener("mousedown",this.pointerDown),this.el.removeEventListener("raycaster-intersected",this.pointerOver),this.el.removeEventListener("raycaster-intersected-cleared",this.pointerOut)},pointerDown(e){this.el.sceneEl.emit(g.SELECTED,{type:a.ANGLE,id:this.el.id},!0)},pointerOver(e){this.state.hovered=!0,this.el.sceneEl.emit(g.POINTER_OVER,{id:this.el.id},!0)},pointerOut(e){this.state.hovered=!1,this.el.sceneEl.emit(g.POINTER_OUT,{},!0)},createMesh(){const e=h.objectToVector3(this.data.edge0Pos),t=h.objectToVector3(this.data.edge1Pos);var s=new THREE.Matrix4;s.lookAt(e,t,(new THREE.Object3D).up),s.multiply((new THREE.Matrix4).set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1));let n=new THREE.CylinderGeometry(this.data.radius,this.data.radius,this.data.length,6,4),i=new THREE.MeshBasicMaterial;const a=new THREE.Mesh(n,i);a.applyMatrix(s),a.position.copy(h.objectToVector3(this.data.position)),this.state.geometry=n,this.state.material=i,this.state.mesh=a;let r=new THREE.CylinderGeometry(this.data.radius,this.data.radius,this.data.length,6,4),o=_.getHaloMaterial();const l=new THREE.Mesh(r,o);this.state.outlineGeometry=r,this.state.outlineMaterialt=o,this.state.outlineMesh=l,a.add(l),this.el.setObject3D("mesh",a),this.el.object3D.renderOrder=d.topLayerRenderOrder-3},init(){this.tickFunction=AFRAME.utils.throttle(this.tickFunction,d.minFrameMS,this),this.bindListeners(),this.addListeners(),this.state={selected:!0,hovered:!1},this.createMesh()},update(e){this.state.selected=this.data.selected,e&&e.angle!==this.data.angle&&this.createMesh()},tickFunction(){const e=this.el;let t=this.state;t.material.color=t.hovered?new THREE.Color(d.buttonColors.hover):t.selected?new THREE.Color(d.buttonColors.active):new THREE.Color(d.buttonColors.up);const s=e.firstChild;if(s){s.object3D.visible=!!t.hovered}},tick(){this.tickFunction()},remove(){this.removeListeners(),this.el.removeObject3D("mesh")}}}static get Tag(){return"al-angle"}}class S{static get Object(){return{schema:{color:{type:"string",default:"#f50057"},scale:{type:"string"}},init(e){this.state={box:new THREE.Box3}},update(){const e=this.el;let t=this.state,s=h.stringToVector3(this.data.scale);t.box.setFromCenterAndSize(new THREE.Vector3(0,0,0),s);let n=new THREE.BoxGeometry(s.x,s.y,s.z),i=new THREE.MeshBasicMaterial({color:this.data.color,visible:!1}),a=new THREE.Mesh(n,i);e.setObject3D("mesh2",a),t.boundingBox=new THREE.Box3Helper(t.box,this.data.color),t.boundingBox.renderOrder=d.topLayerRenderOrder-5,e.setObject3D("mesh",t.boundingBox),t.geometry=n,t.material=i,t.mesh=a},remove(){this.el.removeObject3D("mesh"),this.el.removeObject3D("mesh2")}}}static get Tag(){return"al-bounding-box"}}class v{static get Object(){return{schema:{selected:{type:"boolean"},node1:{type:"vec3"},node2:{type:"vec3"},length:{type:"number"},radius:{type:"number"},nodeScale:{type:"number"}},bindListeners(){this.pointerDown=this.pointerDown.bind(this),this.pointerOver=this.pointerOver.bind(this),this.pointerOut=this.pointerOut.bind(this),this.createMesh=this.createMesh.bind(this)},addListeners(){this.el.sceneEl.addEventListener("mousedown",this.pointerDown,{capture:!1,once:!1,passive:!0}),this.el.addEventListener("raycaster-intersected",this.pointerOver,{capture:!1,once:!1,passive:!0}),this.el.addEventListener("raycaster-intersected-cleared",this.pointerOut,{capture:!1,once:!1,passive:!0})},removeListeners(){this.el.sceneEl.removeEventListener("mousedown",this.pointerDown),this.el.removeEventListener("raycaster-intersected",this.pointerOver),this.el.removeEventListener("raycaster-intersected-cleared",this.pointerOut)},pointerDown(e){this.state.hovered&&this.el.sceneEl.emit(g.SELECTED,{type:a.EDGE,id:this.el.id},!1)},pointerOver(e){this.state.hovered=!0,this.el.sceneEl.emit(g.POINTER_OVER,{id:this.el.id},!1)},pointerOut(e){this.state.hovered=!1,this.el.sceneEl.emit(g.POINTER_OUT,{},!1)},createMesh(){const e=h.objectToVector3(this.data.node1),t=h.objectToVector3(this.data.node2);var s=new THREE.Matrix4;s.lookAt(e,t,(new THREE.Object3D).up),s.multiply((new THREE.Matrix4).set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1));let n=new THREE.CylinderGeometry(this.data.radius,this.data.radius,this.data.length,6,4),i=new THREE.MeshBasicMaterial;const a=new THREE.Mesh(n,i);a.applyMatrix(s),this.state.geometry=n,this.state.material=i,this.state.mesh=a;let r=new THREE.CylinderGeometry(this.data.radius,this.data.radius,this.data.length-2*this.data.nodeScale,6,4),o=_.getHaloMaterial();const l=new THREE.Mesh(r,o);this.state.outlineGeometry=r,this.state.outlineMaterialt=o,this.state.outlineMesh=l,a.add(l),this.el.setObject3D("mesh",a),this.el.object3D.renderOrder=d.topLayerRenderOrder-2},init(){this.tickFunction=AFRAME.utils.throttle(this.tickFunction,d.minFrameMS,this),this.bindListeners(),this.addListeners(),this.state={selected:!0,hovered:!1}},update(e){this.state.selected=this.data.selected,!e||e.radius===this.data.radius&&e.length===this.data.length||this.createMesh()},tickFunction(){const e=this.el;let t=this.state;t.material.color=t.hovered?new THREE.Color(d.buttonColors.hover):t.selected?new THREE.Color(d.buttonColors.active):new THREE.Color(d.buttonColors.up);const s=e.firstChild;if(s){s.object3D.visible=!!t.hovered}},tick(){this.tickFunction()},remove(){this.removeListeners(),this.el.removeObject3D("mesh")}}}static get Tag(){return"al-edge"}}class T{static get Object(){return{schema:{distanceFromTarget:{type:"number",default:.1},target:{type:"vec3"}},init(e){if(this.tickFunction=AFRAME.utils.throttle(this.tickFunction,d.minFrameMS/2,this),this.data.target){let e=h.objectToVector3(this.data.target);this.state={distanceFromTarget:this.data.distanceFromTarget,target:e}}else this.state={distanceFromTarget:this.data.distanceFromTarget,target:new THREE.Vector3(0,0,0)}},update(e){let t=h.objectToVector3(this.data.target);this.state={distanceFromTarget:this.data.distanceFromTarget,target:t}},tickFunction(){let e=this.el,t=this.state;const s=e.sceneEl.camera.position,n=t.target.clone().sub(s.clone()).normalize();e.object3D.position.copy(n.multiplyScalar(t.distanceFromTarget)),e.object3D.lookAt(s)},tick(){this.tickFunction()}}}static get Tag(){return"al-fixed-to-orbit-camera"}}class f{static get Object(){return{schema:{src:{type:"model",default:""},dracoDecoderPath:{type:"string",default:""}},init(){this.model=null,this.loader=new THREE.GLTFLoader,THREE.DRACOLoader.setDecoderPath(this.data.dracoDecoderPath),this.loader.setDRACOLoader(new THREE.DRACOLoader)},update(e){let t=this,s=this.el,n=this.data.src;e&&e.src!==n&&(this.remove(),this.loader.load(n,function(e){let n=m.setup(e);t.model=n.mesh,s.setObject3D("mesh",t.model),s.sceneEl.emit(w.LOADED,{format:"gltf",model:t.model},!1)},void 0,function(e){console.warn(e&&e.message?e.message:"Failed to load glTF model"),s.sceneEl.emit(w.ERROR,{format:"gltf",src:n},!1)}))},remove(){this.model&&this.el.removeObject3D("mesh")}}}static get Tag(){return"al-gltf-model"}}class w{}w.LOADED="al-model-loaded",w.ERROR="al-model-error";class O{static get Object(){return{schema:{},init(){this.tickFunction=AFRAME.utils.throttle(this.tickFunction,d.minFrameMS,this)},tickFunction(){this.el.object3D.lookAt(this.el.sceneEl.camera.position)},tick(){this.tickFunction()}}}static get Tag(){return"al-look-to-camera"}}class A{static get Object(){return{schema:{scale:{type:"number",default:1},selected:{type:"boolean"},graphEnabled:{type:"boolean"}},bindListeners(){this.pointerDown=this.pointerDown.bind(this),this.pointerUp=this.pointerUp.bind(this),this.pointerOver=this.pointerOver.bind(this),this.pointerOut=this.pointerOut.bind(this)},addListeners(){this.el.sceneEl.addEventListener("mousedown",this.pointerDown,{capture:!1,once:!1,passive:!0}),this.el.addEventListener("mouseup",this.pointerUp,{capture:!1,once:!1,passive:!0}),this.el.sceneEl.addEventListener("mouseup",this.pointerUp,{capture:!1,once:!1,passive:!0}),this.el.addEventListener("raycaster-intersected",this.pointerOver,{capture:!1,once:!1,passive:!0}),this.el.addEventListener("raycaster-intersected-cleared",this.pointerOut,{capture:!1,once:!1,passive:!0})},removeListeners(){this.el.sceneEl.removeEventListener("mousedown",this.pointerDown),this.el.sceneEl.removeEventListener("mouseup",this.pointerUp),this.el.removeEventListener("mouseup",this.pointerUp),this.el.removeEventListener("raycaster-intersected",this.pointerOver),this.el.removeEventListener("raycaster-intersected-cleared",this.pointerOut)},pointerDown(e){this.state.hovered&&(this.el.sceneEl.emit(g.SELECTED,{type:a.NODE,id:this.el.id},!0),this.data.graphEnabled)&&(this.state.mouseDown=!0,this.el.sceneEl.emit(g.POINTER_DOWN,{},!0))},pointerUp(e){let t=this.state;this.data.graphEnabled&&(t.dragging=!1,t.mouseDown=!1,this.el.sceneEl.emit(g.POINTER_UP,{},!0))},pointerOver(e){this.state.hovered=!0,this.el.sceneEl.emit(g.POINTER_OVER,{id:this.el.id},!0)},pointerOut(e){let t=this.state;t.hovered=!1,t.mouseDown&&t.selected&&(t.dragging=!0),this.el.sceneEl.emit(g.POINTER_OUT,{},!0)},init(){this.tickFunction=AFRAME.utils.throttle(this.tickFunction,d.minFrameMS,this),this.bindListeners(),this.addListeners();const e=this.data;let t=this.el;const s=t.sceneEl.camera.el.object3DMap.camera,n=new THREE.SphereGeometry(e.scale,16,16);let i=new THREE.MeshBasicMaterial;const a=new THREE.Mesh(n,i);let r=new THREE.SphereGeometry(e.scale,16,16),o=_.getHaloMaterial();const l=new THREE.Mesh(r,o);a.add(l),t.setObject3D("mesh",a),t.object3D.renderOrder=d.topLayerRenderOrder-1,this.state={selected:!0,hovered:!1,geometry:n,material:i,mesh:a,outlineGeometry:r,outlineMaterial:o,outlineMesh:l,camera:s,dragging:!1}},update(){this.state.selected=this.data.selected},tickFunction(){const e=this.el;let t=this.state;this.data.graphEnabled&&t.dragging&&this.el.sceneEl.emit(g.DRAGGED,{id:this.el.id},!0),t.material.color=t.hovered||t.dragging?new THREE.Color(d.buttonColors.hover):t.selected?new THREE.Color(d.buttonColors.active):new THREE.Color(d.buttonColors.up);const s=e.firstChild;if(s){s.object3D.visible=!(!t.hovered&&!t.dragging)}},tick(){this.tickFunction()},remove(){this.removeListeners(),this.el.removeObject3D("mesh")}}}static get Tag(){return"al-node"}}class P{static get Object(){return{schema:{graphEnabled:{type:"boolean"}},bindListeners(){this.canvasMouseDown=this.canvasMouseDown.bind(this),this.pointerOver=this.pointerOver.bind(this),this.pointerOut=this.pointerOut.bind(this),this.elClick=this.elClick.bind(this),this.canvasMouseUp=this.canvasMouseUp.bind(this),this.pointerDown=this.pointerDown.bind(this),this.pointerUp=this.pointerUp.bind(this)},addListeners(){this.el.sceneEl.canvas.addEventListener("mousedown",this.canvasMouseDown,{capture:!1,once:!1,passive:!0}),this.el.sceneEl.canvas.addEventListener("mouseup",this.canvasMouseUp,{capture:!1,once:!1,passive:!0}),this.el.addEventListener("raycaster-intersected",this.pointerOver,{capture:!1,once:!1,passive:!0}),this.el.addEventListener("raycaster-intersected-cleared",this.pointerOut,!1),this.el.addEventListener("click",this.elClick,{capture:!1,once:!1,passive:!0}),this.el.addEventListener("mousedown",this.pointerDown,{capture:!1,once:!1,passive:!0}),this.el.addEventListener("mouseup",this.pointerUp,{capture:!1,once:!1,passive:!0})},removeListeners(){this.el.sceneEl.canvas.removeEventListener("mousedown",this.canvasMouseDown),this.el.sceneEl.canvas.removeEventListener("mouseup",this.canvasMouseUp),this.el.removeEventListener("raycaster-intersected",this.pointerOver),this.el.removeEventListener("raycaster-intersected-cleared",this.pointerOut),this.el.removeEventListener("click",this.elClick),this.el.removeEventListener("mousedown",this.pointerDown),this.el.removeEventListener("mouseup",this.pointerUp)},canvasMouseDown(e){this.state.left=0===e.button},canvasMouseUp(e){h.waitOneFrame(()=>{this.state.left=!1})},pointerOver(e){this.state.intersecting=!0,this.el.sceneEl.emit(D.VALID_TARGET,{valid:!0},!1)},pointerOut(e){this.state.intersecting=!1,this.el.sceneEl.emit(D.VALID_TARGET,{valid:!1},!1)},pointerDown(e){this.data.graphEnabled&&this.el.sceneEl.emit(g.POINTER_DOWN,{},!1)},pointerUp(e){this.data.graphEnabled&&this.el.sceneEl.emit(g.POINTER_UP,{},!1)},elClick(e){this.state.left&&this.data.graphEnabled&&this.el.sceneEl.emit(D.ADD_NODE,{aframeEvent:e},!1)},init(){this.bindListeners(),this.addListeners(),this.state={left:!1,intersecting:!1}},remove(){this.removeListeners()}}}static get Tag(){return"al-node-spawner"}}class D{}D.VALID_TARGET="al-valid-target",D.ADD_NODE="al-add-node";class L{static get Object(){return{dependencies:["camera"],schema:{animating:{type:"boolean",default:!1},autoRotate:{type:"boolean"},autoRotateSpeed:{default:2},controlPosition:{type:"vec3"},controlTarget:{type:"vec3"},dampingFactor:{default:.1},enabled:{default:!0},enableDamping:{default:!0},enableKeys:{default:!0},enablePan:{default:!0},enableRotate:{default:!0},enableZoom:{default:!0},keyPanSpeed:{default:7},maxAzimuthAngle:{type:"number",default:1/0},maxDistance:{default:8e3},maxPolarAngle:{default:88},minAzimuthAngle:{type:"number",default:-1/0},minDistance:{default:1},minPolarAngle:{default:0},rotateSpeed:{default:.05},screenSpacePanning:{default:!1},zoomSpeed:{type:"number",default:.5}},bindMethods(){this.mouseDown=this.mouseDown.bind(this),this.mouseMove=this.mouseMove.bind(this),this.mouseUp=this.mouseUp.bind(this),this.canvasWheel=this.canvasWheel.bind(this),this.getCameraState=this.getCameraState.bind(this),this.handleAnimationCache=this.handleAnimationCache.bind(this),this.onWheel=this.onWheel.bind(this)},addListeners(){window.addEventListener("mouseup",this.mouseUp,{capture:!1,once:!1,passive:!0}),window.addEventListener("mousemove",this.mouseMove,{capture:!1,once:!1,passive:!0}),this.el.sceneEl.canvas.addEventListener("mousedown",this.mouseDown,{capture:!1,once:!1,passive:!0}),this.el.sceneEl.canvas.addEventListener("wheel",this.canvasWheel,{capture:!1,once:!1,passive:!0}),this.el.sceneEl.addEventListener(C.ANIMATION_STARTED,this.handleAnimationCache,!1)},removeListeners(){window.removeEventListener("mouseup",this.mouseUp),window.removeEventListener("mousemove",this.mouseMove),this.el.sceneEl.canvas.removeEventListener("mousedown",this.mouseDown),this.el.sceneEl.canvas.removeEventListener("wheel",this.canvasWheel),this.el.sceneEl.removeEventListener(C.ANIMATION_STARTED,this.handleAnimationCache,!1)},handleAnimationCache(e){this.state.animationCache=e.detail.slerpPath},mouseUp(e){this.state.mouseDown=!1,document.body.style.cursor="grab",this.state.controls.enabled&&this.el.sceneEl.emit(C.INTERACTION_FINISHED,{cameraState:this.getCameraState()},!1)},mouseDown(e){this.state.mouseDown=!0,document.body.style.cursor="grabbing"},mouseMove(e){this.state.mouseDown&&this.el.sceneEl.emit(C.INTERACTION,{cameraState:this.getCameraState()},!1)},onWheel(){const e=this.state;e.wheelMarker=!1,e.wheelCounter2=e.wheelCounter1,setTimeout(()=>{e.wheelCounter2===e.wheelCounter1?(e.wheelMarker=!0,e.wheelCounter1=0,e.wheelCounter2=0,this.el.sceneEl.emit(C.INTERACTION_FINISHED,{cameraState:this.getCameraState()},!1)):this.onWheel()},e.wheelInterval)},canvasWheel(e){const t=this.state;t.wheelCounter1+=1,t.wheelMarker&&this.onWheel(),this.el.sceneEl.emit(C.INTERACTION,{cameraState:this.getCameraState()},!1)},init(){let e=this.el,t=this.data;document.body.style.cursor="grab",this.tickFunction=AFRAME.utils.throttle(this.tickFunction,d.minFrameMS,this);let s=new THREE.OrbitControls(e.getObject3D("camera"),e.sceneEl.renderer.domElement),n=h.objectToVector3(t.controlPosition),i=h.objectToVector3(t.controlTarget);s.object.position.copy(n),e.getObject3D("camera").position.copy(n),s.target.copy(i),this.state={animationCache:[],controls:s,mouseDown:!1,wheelCounter1:0,wheelCounter2:void 0,wheelInterval:50,wheelMarker:!0},this.bindMethods(),this.addListeners(),h.waitOneFrame(()=>{this.el.sceneEl.emit(C.INTERACTION,{cameraState:this.getCameraState()},!1)})},getCameraState(){return{position:this.state.controls.object.position,target:this.state.controls.target}},update(e){let t=this.state.controls;const s=this.data;t.target=h.objectToVector3(s.controlTarget),t.autoRotate=s.autoRotate,t.autoRotateSpeed=s.autoRotateSpeed,t.dampingFactor=s.dampingFactor,t.enabled=s.enabled,t.enableDamping=s.enableDamping,t.enableKeys=s.enableKeys,t.enablePan=s.enablePan,t.enableRotate=s.enableRotate,t.enableZoom=s.enableZoom,t.keyPanSpeed=s.keyPanSpeed,t.maxPolarAngle=THREE.Math.degToRad(s.maxPolarAngle),t.maxAzimuthAngle=THREE.Math.degToRad(s.maxAzimuthAngle),t.maxDistance=s.maxDistance,t.minDistance=s.minDistance,t.minPolarAngle=THREE.Math.degToRad(s.minPolarAngle),t.minAzimuthAngle=THREE.Math.degToRad(s.minAzimuthAngle),t.rotateSpeed=s.rotateSpeed,t.screenSpacePanning=s.screenSpacePanning,t.zoomSpeed=s.zoomSpeed,this.el.getObject3D("camera").position.copy(h.objectToVector3(s.controlPosition))},tickFunction(){let e=this.state.controls;if(e.enabled){if(this.data.animating){let t=this.state.animationCache.shift();t&&t.position&&t.target&&(e.object.position.copy(t.position),this.el.getObject3D("camera").position.copy(t.position),e.target.copy(t.target)),0===this.state.animationCache.length&&this.el.sceneEl.emit(C.ANIMATION_FINISHED,{},!1)}e.enabled&&(e.enableDamping||e.autoRotate)&&e.update()}},tick(){this.tickFunction()},remove(){this.removeListeners();let e=this.state;e.controls.dispose(),e=null}}}static get Tag(){return"al-orbit-control"}}class C{}C.INTERACTION="al-orbit-interaction",C.INTERACTION_FINISHED="al-orbit-controls-interaction-finished",C.ANIMATION_STARTED="al-orbit-controls-animation-started",C.ANIMATION_FINISHED="al-orbit-controls-animation-finished";class N{static get Object(){return{schema:{order:{type:"number",default:d.topLayerRenderOrder}},init(e){Object.keys(this.el.object3DMap).forEach(e=>{this.el.object3DMap[e].renderOrder=this.data.order})},update(){Object.keys(this.el.object3DMap).forEach(e=>{this.el.object3DMap[e].renderOrder=this.data.order})}}}static get Tag(){return"al-render-order"}}class I{static get Object(){return{schema:{},init(e){this.setDepth(this.el.object3DMap.mesh),this.setDepth(this.el.object3DMap.text)},setDepth(e){e&&(e.renderOrder=d.topLayerRenderOrder,e.material&&(e.material.depthTest=!1))}}}static get Tag(){return"al-render-overlaid"}}class R{static get Object(){return{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init(e){this.geometry=new THREE.TetrahedronGeometry(e.radius,e.detail),this.geometry.applyMatrix((new THREE.Matrix4).makeRotationAxis(new THREE.Vector3(1,0,-1).normalize(),Math.atan(Math.sqrt(2))))}}}static get Tag(){return"al-spinner"}}class M{constructor(){}load(e,t){return new Promise((s,n)=>{const i=new XMLHttpRequest;i.open("GET",e,!0),i.onload=(()=>{let e=JSON.parse(i.responseText);e=this._mapfiles(e.baseurl,e.series);const a=new AMI.VolumeLoader(t);a.load(e).then(()=>{const e=a.data[0].mergeSeries(a.data)[0].stack[0];a.free(),s(e)}).catch(e=>{console.log("Volume load error"),n(e)})}),i.onerror=(e=>{n(e)}),i.send()})}_mapfiles(e,t){return t.map(t=>(e.endsWith("/")||(e+="/"),`${e}${t}`))}}class H{static get Object(){return{schema:{displayMode:{type:"string"},isWebGl2:{type:"boolean"},slicesIndex:{type:"number"},slicesOrientation:{type:"string"},slicesWindowCenter:{type:"number"},slicesWindowWidth:{type:"number"},src:{type:"string"},srcLoaded:{type:"boolean"},volumeSteps:{type:"number"},volumeWindowCenter:{type:"number"},volumeWindowWidth:{type:"number"}},bindMethods(){this.addListeners=this.addListeners.bind(this),this.createVolumePlane=this.createVolumePlane.bind(this),this.handleStack=this.handleStack.bind(this),this.onInteraction=this.onInteraction.bind(this),this.onInteractionFinished=this.onInteractionFinished.bind(this),this.removeListeners=this.removeListeners.bind(this),this.renderBufferScene=this.renderBufferScene.bind(this),this.rendererResize=this.rendererResize.bind(this),this.createBufferTexture=this.createBufferTexture.bind(this)},addListeners(){this.el.sceneEl.addEventListener("rendererresize",this.rendererResize,!1),this.el.sceneEl.addEventListener(C.INTERACTION,this.onInteraction,!1),this.el.sceneEl.addEventListener(C.INTERACTION_FINISHED,this.onInteractionFinished,!1)},removeListeners(){this.el.sceneEl.removeEventListener("rendererresize",this.rendererResize),this.el.sceneEl.removeEventListener(C.INTERACTION,this.onInteraction),this.el.sceneEl.removeEventListener(C.INTERACTION_FINISHED,this.onInteractionFinished)},init(){this.tickFunction=AFRAME.utils.throttle(this.tickFunction,d.minFrameMS,this),this.loader=new M,this.state={bufferScene:new THREE.Scene,bufferSceneTextureHeight:this.el.sceneEl.canvas.clientHeight,bufferSceneTextureWidth:this.el.sceneEl.canvas.clientWidth},this.bindMethods(),this.addListeners(),this.createBufferTexture(),this.debouncedRenderBufferScene=u.debounce(this.renderBufferScene,d.minFrameMS).bind(this)},createBufferTexture(){this.state.bufferSceneTexture=new THREE.WebGLRenderTarget(this.state.bufferSceneTextureWidth,this.state.bufferSceneTextureHeight,{minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter}),this.el.sceneEl.object3D.background=this.state.bufferSceneTexture.texture},onInteraction(e){this.state.stackhelper&&(this.state.stackhelper.steps=2,this.renderBufferScene())},onInteractionFinished(e){this.state.stackhelper&&(this.state.stackhelper.steps=this.data.volumeSteps,this.debouncedRenderBufferScene())},createVolumePlane(){let e=this.el.sceneEl.querySelector("#target-entity");if(e){let t=this.state,s=t.stackhelper.mesh.geometry.clone();s.computeBoundingBox(),s.computeBoundingSphere();let n=e.object3D.position.clone().add(E.getGeometryCenter(s)),i=Math.max(this.state.stackhelper.stack.dimensionsIJK.x,Math.max(this.state.stackhelper.stack.dimensionsIJK.y,this.state.stackhelper.stack.dimensionsIJK.z)),a=new THREE.PlaneGeometry(i,i);t.bufferScenePlaneGeometry=a;let r=new THREE.MeshBasicMaterial({visible:!1});t.bufferScenePlaneMaterial=r;let o=new THREE.Mesh(a,r);o.position.copy(n),o.renderOrder=d.topLayerRenderOrder-4,t.bufferScenePlaneMesh=o,this.el.setObject3D("mesh",o)}},rendererResize(){let e=this.state;(e.bufferSceneTextureWidth!==this.el.sceneEl.canvas.clientWidth||e.bufferSceneTextureHeight!==this.el.sceneEl.canvas.clientHeight)&&this.data.displayMode===t.VOLUME&&(e.bufferSceneTextureWidth=this.el.sceneEl.canvas.clientWidth,e.bufferSceneTextureHeight=this.el.sceneEl.canvas.clientHeight,this.createBufferTexture(),this.renderBufferScene())},renderBufferScene(){this.data.displayMode===t.VOLUME&&this.el.sceneEl.renderer.render(this.state.bufferScene,this.el.sceneEl.camera,this.state.bufferSceneTexture)},handleStack(e){const s=this.state,n=this.el;switch(s.stack=e,this.data.displayMode){case t.SLICES:s.stackhelper=new AMI.StackHelper(s.stack),s.stackhelper.bbox.visible=!1,s.stackhelper.border.color=d.colorValues.blue;break;case t.VOLUME:{const e=n.sceneEl.parentEl.querySelector("#lut-canvases");s.lutHelper=new AMI.LutHelper(e),s.lutHelper.luts=AMI.LutHelper.presetLuts(),s.lutHelper.lutsO=AMI.LutHelper.presetLutsO(),s.stackhelper=new AMI.VolumeRenderHelper(s.stack),s.stackhelper.textureLUT=s.lutHelper.texture;break}}n.object3DMap.mesh&&n.removeObject3D("mesh"),this.data.displayMode===t.SLICES?n.setObject3D("mesh",this.state.stackhelper):(this.state.bufferScene.children.length&&this.state.bufferScene.remove(this.state.bufferScene.children[0]),this.state.bufferScene.add(this.state.stackhelper),this.createVolumePlane()),n.sceneEl.emit(W.LOADED,s.stackhelper,!1)},update(e){const s=this.state;this.data.src&&(e&&e.src!==this.data.src?this.loader.load(this.data.src,this.el).then(e=>{this.handleStack(e)}):e&&e.displayMode!==this.data.displayMode&&s.stack&&(this.removeListeners(),this.handleStack(s.stack),this.addListeners(),this.data.displayMode===t.VOLUME?(this.createBufferTexture(),setTimeout(()=>{this.renderBufferScene()},250)):this.el.sceneEl.object3D.background=null))},tickFunction(){if(this.state.stackhelper)switch(this.data.displayMode){case t.SLICES:this.el.setObject3D("mesh",this.state.stackhelper);break;case t.VOLUME:this.state.bufferScenePlaneMesh.lookAt(this.el.sceneEl.camera.position)}},tick(){this.tickFunction()},remove(){this.el.removeObject3D("mesh"),this.removeListeners(),this.state.bufferScenePlaneMesh&&this.state.bufferScenePlaneMesh.remove(),this.state.bufferScenePlaneMaterial&&this.state.bufferScenePlaneMaterial.dispose(),this.state.bufferScenePlaneGeometry&&this.state.bufferScenePlaneGeometry.dispose()}}}static get Tag(){return"al-volume"}}class W{}W.LOADED="al-volume-loaded",W.ERROR="al-volume-error",W.RENDER_LOW="al-volume-render-low",W.RENDER_FULL="al-volume-render-full",function(e){e.NULL="NULL",e.ERROR="ERROR",e.APP_CLEAR_ANGLES="APP_LOAD_ANGLES",e.APP_CLEAR_EDGES="APP_LOAD_EDGES",e.APP_CLEAR_NODES="APP_LOAD_NODES",e.APP_DELETE_ANGLE="APP_DELETE_ANGLE",e.APP_DELETE_EDGE="APP_DELETE_EDGE",e.APP_DELETE_NODE="APP_DELETE_NODE",e.APP_SELECT_ANGLE="APP_SELECT_ANGLE",e.APP_SELECT_EDGE="APP_SELECT_EDGE",e.APP_SELECT_NODE="APP_SELECT_NODE",e.APP_SET_ANGLE="APP_SET_ANGLE",e.APP_SET_BOUNDINGBOX_VISIBLE="APP_SET_BOUNDINGBOX_VISIBLE",e.APP_SET_CAMERA="APP_SET_CAMERA",e.APP_SET_CONTROLS_ENABLED="APP_SET_CONTROLS_ENABLED",e.APP_SET_DISPLAY_MODE="APP_SET_DISPLAY_MODE",e.APP_SET_EDGE="APP_SET_EDGE",e.APP_SET_NODE="APP_SET_NODE",e.APP_SET_NODES_ENABLED="APP_SET_NODES_ENABLED",e.APP_SET_ORIENTATION="APP_SET_ORIENTATION",e.APP_SET_SLICES_INDEX="APP_SET_SLICES_INDEX",e.APP_SET_SLICES_WINDOW_CENTER="APP_SET_SLICES_WINDOW_CENTER",e.APP_SET_SLICES_WINDOW_WIDTH="APP_SET_SLICES_WINDOW_WIDTH",e.APP_SET_SRC="APP_SET_SRC",e.APP_SET_SRC_LOADED="APP_SET_SRC_LOADED",e.APP_SET_VOLUME_STEPS="APP_SET_VOLUME_STEPS",e.APP_SET_VOLUME_WINDOW_CENTER="APP_SET_VOLUME_WINDOW_CENTER",e.APP_SET_VOLUME_WINDOW_WIDTH="APP_SET_VOLUME_WINDOW_WIDTH"}(l||(l={}));const x=e=>async(t,s)=>t({type:l.APP_SET_SRC,payload:e}),k=e=>async(t,s)=>t({type:l.APP_SET_SRC_LOADED,payload:e}),F=e=>async(t,s)=>t({type:l.APP_SET_NODE,payload:e}),j=e=>async(t,s)=>t({type:l.APP_DELETE_NODE,payload:e}),V=e=>async(t,s)=>t({type:l.APP_SELECT_NODE,payload:e}),G=e=>async(t,s)=>t({type:l.APP_CLEAR_NODES,payload:e}),B=e=>async(t,s)=>t({type:l.APP_SET_EDGE,payload:e}),U=e=>async(t,s)=>t({type:l.APP_DELETE_EDGE,payload:e}),$=e=>async(t,s)=>t({type:l.APP_SELECT_EDGE,payload:e}),z=e=>async(t,s)=>t({type:l.APP_CLEAR_EDGES,payload:e}),q=e=>async(t,s)=>t({type:l.APP_SET_ANGLE,payload:e}),K=e=>async(t,s)=>t({type:l.APP_DELETE_ANGLE,payload:e}),J=e=>async(t,s)=>t({type:l.APP_SELECT_ANGLE,payload:e}),X=e=>async(t,s)=>t({type:l.APP_CLEAR_ANGLES,payload:e}),Q=e=>async(t,s)=>t({type:l.APP_SET_DISPLAY_MODE,payload:e}),Y=e=>async(t,s)=>t({type:l.APP_SET_NODES_ENABLED,payload:e}),Z=e=>async(t,s)=>t({type:l.APP_SET_BOUNDINGBOX_VISIBLE,payload:e}),ee=e=>async(t,s)=>t({type:l.APP_SET_ORIENTATION,payload:e}),te=e=>async(t,s)=>t({type:l.APP_SET_SLICES_INDEX,payload:e}),se=e=>async(t,s)=>t({type:l.APP_SET_SLICES_WINDOW_WIDTH,payload:e}),ne=e=>async(t,s)=>t({type:l.APP_SET_SLICES_WINDOW_CENTER,payload:e}),ie=e=>async(t,s)=>t({type:l.APP_SET_VOLUME_STEPS,payload:e}),ae=e=>async(t,s)=>t({type:l.APP_SET_VOLUME_WINDOW_WIDTH,payload:e}),re=e=>async(t,s)=>t({type:l.APP_SET_VOLUME_WINDOW_CENTER,payload:e}),oe=e=>async(t,s)=>t({type:l.APP_SET_CAMERA,payload:e}),le=e=>async(t,s)=>t({type:l.APP_SET_CONTROLS_ENABLED,payload:e});var de=function(e){var t,s=("undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof module?module:Function("return this")()).Symbol;return"function"==typeof s?s.observable?t=s.observable:(t=s("observable"),s.observable=t):t="@@observable",t}(),ce=function(){return Math.random().toString(36).substring(7).split("").join(".")},he={INIT:"@@redux/INIT"+ce(),REPLACE:"@@redux/REPLACE"+ce(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+ce()}};function pe(e,t,s){var n;if("function"==typeof t&&"function"==typeof s||"function"==typeof s&&"function"==typeof arguments[3])throw new Error("It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function");if("function"==typeof t&&void 0===s&&(s=t,t=void 0),void 0!==s){if("function"!=typeof s)throw new Error("Expected the enhancer to be a function.");return s(pe)(e,t)}if("function"!=typeof e)throw new Error("Expected the reducer to be a function.");var i=e,a=t,r=[],o=r,l=!1;function d(){o===r&&(o=r.slice())}function c(){if(l)throw new Error("You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return a}function h(e){if("function"!=typeof e)throw new Error("Expected the listener to be a function.");if(l)throw new Error("You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");var t=!0;return d(),o.push(e),function(){if(t){if(l)throw new Error("You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");t=!1,d();var s=o.indexOf(e);o.splice(s,1)}}}function p(e){if(!function(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}(e))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===e.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(l)throw new Error("Reducers may not dispatch actions.");try{l=!0,a=i(a,e)}finally{l=!1}for(var t=r=o,s=0;s<t.length;s++)(0,t[s])();return e}return p({type:he.INIT}),(n={dispatch:p,subscribe:h,getState:c,replaceReducer:function(e){if("function"!=typeof e)throw new Error("Expected the nextReducer to be a function.");i=e,p({type:he.REPLACE})}})[de]=function(){var e,t=h;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new TypeError("Expected the observer to be an object.");function s(){e.next&&e.next(c())}return s(),{unsubscribe:t(s)}}})[de]=function(){return this},e},n}function ue(e,t){var s=t&&t.type;return"Given "+(s&&'action "'+String(s)+'"'||"an action")+', reducer "'+e+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.'}function Ee(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function me(e){return function(t){var s=t.dispatch,n=t.getState;return function(t){return function(i){return"function"==typeof i?i(s,n,e):t(i)}}}}var ge=me();ge.withExtraArgument=me;const be=function(e){for(var t=Object.keys(e),s={},n=0;n<t.length;n++){var i=t[n];"function"==typeof e[i]&&(s[i]=e[i])}var a,r=Object.keys(s);try{!function(e){Object.keys(e).forEach(function(t){var s=e[t];if(void 0===s(void 0,{type:he.INIT}))throw new Error('Reducer "'+t+"\" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.");if(void 0===s(void 0,{type:he.PROBE_UNKNOWN_ACTION()}))throw new Error('Reducer "'+t+"\" returned undefined when probed with a random type. Don't try to handle "+he.INIT+' or other actions in "redux/*" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.')})}(s)}catch(e){a=e}return function(e,t){if(void 0===e&&(e={}),a)throw a;for(var n=!1,i={},o=0;o<r.length;o++){var l=r[o],d=e[l],c=(0,s[l])(d,t);if(void 0===c){var h=ue(l,t);throw new Error(h)}i[l]=c,n=n||c!==d}return n?i:e}}({app:(e=(()=>({angles:new Map,boundingBoxEnabled:!1,camera:null,controlsEnabled:!0,displayMode:t.MESH,edges:new Map,nodes:new Map,graphEnabled:!1,orientation:s.CORONAL,selected:null,slicesIndex:0,slicesWindowCenter:0,slicesWindowWidth:0,src:null,srcLoaded:!1,volumeSteps:16,volumeWindowCenter:0,volumeWindowWidth:0}))(),n)=>{switch(n.type){case l.APP_SET_SRC:{let i=t.MESH;if(n.payload){const e=E.getFileExtension(n.payload);Object.values(r).includes(e)||(i=t.SLICES)}return Object.assign({},e,{angles:new Map,controlsEnabled:!1,displayMode:i,edges:new Map,nodes:new Map,orientation:s.CORONAL,selected:null,slicesIndex:0,slicesWindowCenter:0,slicesWindowWidth:0,src:n.payload,srcLoaded:!1,volumeSteps:16,volumeWindowCenter:0,volumeWindowWidth:0})}case l.APP_SET_SRC_LOADED:return Object.assign({},e,{controlsEnabled:n.payload,srcLoaded:n.payload});case l.APP_SET_NODE:{const[t,s]=n.payload,i=JSON.parse(JSON.stringify(s)),a=e.nodes.get(t);let r=Object.assign({},a,i);return Object.assign({},e,{selected:a?e.selected:t,nodes:new Map(e.nodes).set(t,r)})}case l.APP_DELETE_NODE:return Object.assign({},e,{selected:e.selected===n.payload?null:e.selected,nodes:new Map([...e.nodes].filter(([e])=>e!==n.payload)),edges:new Map([...e.edges].filter(([e,t])=>n.payload!==t.node1Id&&n.payload!==t.node2Id))});case l.APP_SELECT_NODE:return Object.assign({},e,{selected:n.payload});case l.APP_CLEAR_NODES:return Object.assign({},e,{nodes:new Map});case l.APP_SET_EDGE:{const[t,s]=n.payload,i=JSON.parse(JSON.stringify(s)),a=e.edges.get(t);let r=Object.assign({},a,i);return Object.assign({},e,{selected:a?e.selected:t,edges:new Map(e.edges).set(t,r)})}case l.APP_DELETE_EDGE:return Object.assign({},e,{selected:e.selected===n.payload?null:e.selected,edges:new Map([...e.edges].filter(([e])=>e!==n.payload)),angles:new Map([...e.angles].filter(([e,t])=>n.payload!==t.edge1Id&&n.payload!==t.edge2Id))});case l.APP_SELECT_EDGE:return Object.assign({},e,{selected:n.payload});case l.APP_CLEAR_EDGES:return Object.assign({},e,{edges:new Map});case l.APP_SET_ANGLE:{const[t,s]=n.payload,i=JSON.parse(JSON.stringify(s)),a=e.angles.get(t);let r=Object.assign({},a,i);return Object.assign({},e,{selected:a?e.selected:t,angles:new Map(e.angles).set(t,r)})}case l.APP_DELETE_ANGLE:return Object.assign({},e,{selected:e.selected===n.payload?null:e.selected,angles:new Map([...e.angles].filter(([e])=>e!==n.payload))});case l.APP_SELECT_ANGLE:return Object.assign({},e,{selected:n.payload});case l.APP_CLEAR_ANGLES:return Object.assign({},e,{angles:new Map});case l.APP_SET_DISPLAY_MODE:return Object.assign({},e,{displayMode:n.payload});case l.APP_SET_ORIENTATION:return Object.assign({},e,{slicesIndex:void 0,orientation:n.payload});case l.APP_SET_NODES_ENABLED:return Object.assign({},e,{graphEnabled:n.payload});case l.APP_SET_BOUNDINGBOX_VISIBLE:return Object.assign({},e,{boundingBoxEnabled:n.payload});case l.APP_SET_SLICES_INDEX:return Object.assign({},e,{slicesIndex:n.payload});case l.APP_SET_SLICES_WINDOW_WIDTH:return Object.assign({},e,{slicesWindowWidth:n.payload});case l.APP_SET_SLICES_WINDOW_CENTER:return Object.assign({},e,{slicesWindowCenter:n.payload});case l.APP_SET_VOLUME_STEPS:return Object.assign({},e,{volumeSteps:n.payload});case l.APP_SET_VOLUME_WINDOW_WIDTH:return Object.assign({},e,{volumeWindowWidth:n.payload});case l.APP_SET_VOLUME_WINDOW_CENTER:return Object.assign({},e,{volumeWindowCenter:n.payload});case l.APP_SET_CAMERA:return Object.assign({},e,{camera:Object.assign({},e.camera,n.payload)});case l.APP_SET_CONTROLS_ENABLED:return Object.assign({},e,{controlsEnabled:n.payload})}return e}}),_e=e=>pe(be,e,function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return function(e){return function(){var s=e.apply(void 0,arguments),n=function(){throw new Error("Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")},i={getState:s.getState,dispatch:function(){return n.apply(void 0,arguments)}},a=t.map(function(e){return e(i)});return function(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{},n=Object.keys(s);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(s).filter(function(e){return Object.getOwnPropertyDescriptor(s,e).enumerable}))),n.forEach(function(t){Ee(e,t,s[t])})}return e}({},s,{dispatch:n=function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce(function(e,t){return function(){return e(t.apply(void 0,arguments))}})}.apply(void 0,a)(s.dispatch)})}}}(ge));class ye{constructor(){this._hovered=null,this._isShiftDown=!1,this._isWebGl2=!0,this.width="640",this.height="480"}async load(e){this.src?(this._setSrc(null),setTimeout(()=>{this._setSrc(e)},d.minLoadingMS)):this._setSrc(e)}async resize(){this._resize()}async setNode(e){this._setNode(e)}async setGraph(e){this._setGraph(e)}async deleteNode(e){this._deleteNode(e)}async clearGraph(){this._clearGraph()}async selectNode(e){this._selectNode(e,!0)}async deleteEdge(e){this._deleteEdge(e)}async deleteAngle(e){this._deleteAngle(e)}async setEdge(e){this._setEdge(e)}async setDisplayMode(e){this._setDisplayMode(e)}async setGraphEnabled(e){this._setGraphEnabled(e)}async setBoundingBoxEnabled(e){this._setBoundingBoxEnabled(e)}async setSlicesIndex(e){this._setSlicesIndex(e)}async setOrientation(e){this._setOrientation(e)}async setSlicesWindowCenter(e){this._setSlicesWindowCenter(e)}async setSlicesWindowWidth(e){this._setSlicesWindowWidth(e)}async setVolumeSteps(e){this._setVolumeSteps(e)}async setVolumeWindowCenter(e){this._setVolumeWindowCenter(e)}async setVolumeWindowWidth(e){this._setVolumeWindowWidth(e)}componentWillLoad(){this._isWebGl2=h.isWebGL2Available(),c.registerGeometry(R.Tag,R.Object),c.registerComponent(A.Tag,A.Object),c.registerComponent(S.Tag,S.Object),c.registerComponent(f.Tag,f.Object),c.registerComponent(H.Tag,H.Object),c.registerComponent(P.Tag,P.Object),c.registerComponent(L.Tag,L.Object),c.registerComponent(T.Tag,T.Object),c.registerComponent(O.Tag,O.Object),c.registerComponent(I.Tag,I.Object),c.registerComponent(N.Tag,N.Object),c.registerComponent(v.Tag,v.Object),c.registerComponent(y.Tag,y.Object),this.store.setStore(_e({})),this.store.mapStateToProps(this,e=>{const{app:{angles:t,boundingBoxEnabled:s,camera:n,controlsEnabled:i,displayMode:a,edges:r,graphEnabled:o,nodes:l,orientation:d,selected:c,slicesIndex:h,slicesWindowCenter:p,slicesWindowWidth:u,src:E,srcLoaded:m,volumeSteps:g,volumeWindowCenter:b,volumeWindowWidth:_}}=e;return{angles:t,boundingBoxEnabled:s,camera:n,controlsEnabled:i,displayMode:a,edges:r,graphEnabled:o,nodes:l,orientation:d,selected:c,slicesIndex:h,slicesWindowCenter:p,slicesWindowWidth:u,src:E,srcLoaded:m,volumeSteps:g,volumeWindowCenter:b,volumeWindowWidth:_}}),this.store.mapDispatchToProps(this,{appClearAngles:X,appClearEdges:z,appClearNodes:G,appDeleteAngle:K,appDeleteEdge:U,appDeleteNode:j,appSelectAngle:J,appSelectEdge:$,appSelectNode:V,appSetAngle:q,appSetBoundingBoxEnabled:Z,appSetCamera:oe,appSetControlsEnabled:le,appSetDisplayMode:Q,appSetEdge:B,appSetGraphEnabled:Y,appSetNode:F,appSetOrientation:ee,appSetSlicesIndex:te,appSetSlicesWindowCenter:ne,appSetSlicesWindowWidth:se,appSetSrc:x,appSetSrcLoaded:k,appSetVolumeSteps:ie,appSetVolumeWindowCenter:re,appSetVolumeWindowWidth:ae}),this._controlsAnimationFinishedHandler=this._controlsAnimationFinishedHandler.bind(this),this._controlsInteractionHandler=this._controlsInteractionHandler.bind(this),this._graphEntryDraggedHandler=this._graphEntryDraggedHandler.bind(this),this._graphEntryPointerDownHandler=this._graphEntryPointerDownHandler.bind(this),this._graphEntryPointerOutHandler=this._graphEntryPointerOutHandler.bind(this),this._graphEntryPointerOverHandler=this._graphEntryPointerOverHandler.bind(this),this._graphEntryPointerUpHandler=this._graphEntryPointerUpHandler.bind(this),this._graphEntrySelectedHandler=this._graphEntrySelectedHandler.bind(this),this._graphEntryValidTargetHandler=this._graphEntryValidTargetHandler.bind(this),this._keyDownHandler=this._keyDownHandler.bind(this),this._keyUpHandler=this._keyUpHandler.bind(this),this._controlsInteractionFinishedHandler=this._controlsInteractionFinishedHandler.bind(this),this._spawnNodeHandler=this._spawnNodeHandler.bind(this),this._srcLoaded=this._srcLoaded.bind(this),this._debouncedAppSetCamera=u.debounce(this.appSetCamera,d.minFrameMS).bind(this)}_renderSpinner(){if(this.src&&!this.srcLoaded)return e("div",{id:"spinner"},e("div",{class:"square"}))}_renderSrc(){if(!this.src)return null;switch(this.displayMode){case t.MESH:return e("a-entity",{class:"collidable","al-node-spawner":`\n              graphEnabled: ${this.graphEnabled};\n            `,"al-gltf-model":`\n              src: url(${this.src});\n              dracoDecoderPath: ${this.dracoDecoderPath};\n            `,position:"0 0 0",scale:"1 1 1",ref:e=>this._targetEntity=e});case t.SLICES:return e("a-entity",{id:"target-entity",class:"collidable","al-node-spawner":`\n              graphEnabled: ${this.graphEnabled};\n            `,"al-volume":`\n              srcLoaded: ${this.srcLoaded};\n              src: ${this.src};\n              displayMode: ${this.displayMode};\n              slicesIndex: ${this.slicesIndex};\n              slicesOrientation: ${this.orientation};\n              slicesWindowWidth: ${this.slicesWindowWidth};\n              slicesWindowCenter: ${this.slicesWindowCenter};\n              volumeSteps: ${this.volumeSteps};\n              volumeWindowCenter: ${this.volumeWindowCenter};\n              volumeWindowWidth: ${this.volumeWindowWidth};\n              isWebGl2: ${this._isWebGl2};\n            `,position:"0 0 0",ref:e=>this._targetEntity=e});case t.VOLUME:return e("a-entity",{id:"target-entity","al-volume":`\n              srcLoaded: ${this.srcLoaded};\n              src: ${this.src};\n              displayMode: ${this.displayMode};\n              slicesIndex: ${this.slicesIndex};\n              slicesOrientation: ${this.orientation};\n              slicesWindowWidth: ${this.slicesWindowWidth};\n              slicesWindowCenter: ${this.slicesWindowCenter};\n              volumeSteps: ${this.volumeSteps};\n              volumeWindowCenter: ${this.volumeWindowCenter};\n              volumeWindowWidth: ${this.volumeWindowWidth};\n              isWebGl2: ${this._isWebGl2};\n            `,position:"0 0 0",ref:e=>this._targetEntity=e})}}_renderBoundingBox(){if(this.srcLoaded&&this.boundingBoxEnabled){let s,n=new THREE.Vector3;switch(this._boundingBox.getSize(n),this.displayMode){case t.MESH:s=this._targetEntity.object3D.position.clone();break;case t.VOLUME:case t.SLICES:s=this._targetEntity.object3D.position.clone().add(E.getGeometryCenter(this._mesh.geometry))}return e("a-entity",this.displayMode===t.VOLUME?{position:h.vector3ToString(s),"al-bounding-box":`\n              scale: ${h.vector3ToString(n)};\n              color: ${d.colorValues.red};\n            `,"al-node-spawner":`\n              graphEnabled: ${this.graphEnabled};\n            `,class:"collidable",ref:e=>this._boundingEntity=e}:{position:h.vector3ToString(s),"al-bounding-box":`\n              scale: ${h.vector3ToString(n)};\n              color: ${d.colorValues.red};\n            `,ref:e=>this._boundingEntity=e})}return null}_renderNodes(){return Array.from(this.nodes).map(t=>{const[s,n]=t;let i=new THREE.Vector3(0,2.5,0);return i.multiplyScalar(n.scale),e("a-entity",{class:"collidable",id:s,position:n.position,"al-node":`\n            scale: ${n.scale};\n            selected: ${this.selected===s};\n            graphEnabled: ${this.graphEnabled};\n          `},e("a-entity",{text:`\n              value: ${n.title};\n              side: double;\n              align: center;\n              baseline: bottom;\n              anchor: center;\n              width: ${d.fontSizeMedium*this._boundingSphereRadius}\n            `,"al-look-to-camera":!0,"al-render-overlaid":!0,visible:`${this.selected===s}`,position:h.vector3ToString(i),id:`${s}-label`}))})}_renderEdges(){return Array.from(this.edges).map(s=>{const[n,i]=s,a=this.nodes.get(i.node1Id),r=this.nodes.get(i.node2Id);if(a&&r){const s=h.stringToVector3(a.position);let i=h.stringToVector3(r.position).clone().sub(s),o=i.length();i=i.normalize().multiplyScalar(.5*o);let l=s.clone().add(i),c=new THREE.Vector3(0,2.5,0),p=(a.scale+r.scale)/2,u=this._boundingSphereRadius*d.edgeSize;return c.multiplyScalar(p),e("a-entity",{class:"collidable",id:n,position:h.vector3ToString(l),"al-edge":`\n              length: ${o};\n              node1: ${a.position};\n              node2: ${r.position};\n              selected: ${this.selected===n};\n              radius: ${u};\n              nodeScale: ${p};\n            `},e("a-entity",{id:`${n}-title`,text:`\n                value: ${o.toFixed(d.angleUnitsDecimalPlaces)+(this.displayMode===t.MESH?"m":"mm")};\n                side: double;\n                align: center;\n                baseline: bottom;\n                anchor: center;\n                width: ${d.fontSizeSmall*this._boundingSphereRadius}\n              `,position:h.vector3ToString(c),visible:`${this.selected===n}`,"al-look-to-camera":!0,"al-render-overlaid":!0}))}})}_renderAngles(){return Array.from(this.angles).map(t=>{const[s,n]=t,i=this.edges.get(n.edge1Id),a=this.edges.get(n.edge2Id);if(i&&a){let t,n,r,o=this._boundingSphereRadius*d.edgeSize;i.node1Id===a.node1Id?(t=this.nodes.get(a.node1Id),n=this.nodes.get(i.node2Id),r=this.nodes.get(a.node2Id)):i.node1Id===a.node2Id?(t=this.nodes.get(a.node2Id),n=this.nodes.get(i.node2Id),r=this.nodes.get(a.node1Id)):i.node2Id===a.node1Id?(t=this.nodes.get(a.node1Id),n=this.nodes.get(i.node1Id),r=this.nodes.get(a.node2Id)):i.node2Id===a.node2Id&&(t=this.nodes.get(a.node2Id),n=this.nodes.get(i.node1Id),r=this.nodes.get(a.node1Id));const l=h.stringToVector3(n.position),c=h.stringToVector3(r.position),p=h.stringToVector3(t.position);let u=l.clone().sub(p).normalize(),E=c.clone().sub(p).normalize(),m=E.angleTo(u);const g=Math.min(p.distanceTo(l),p.distanceTo(c));let b=Math.min(.25*g,25*o);b=Math.max(b,10*o);let _=u.clone().multiplyScalar(b),y=E.clone().multiplyScalar(b),S=_.clone().distanceTo(y.clone()),v=_.clone().add(y.clone()).divideScalar(2),T=new THREE.Vector3(0,2.5,0);return T.multiplyScalar((n.scale+r.scale+t.scale)/3),e("a-entity",{class:"collidable",id:s,position:t.position,"al-angle":`\n              selected: ${this.selected===s};\n              edge0Pos: ${h.vector3ToString(_)};\n              edge1Pos: ${h.vector3ToString(y)};\n              position: ${h.vector3ToString(v)};\n              length: ${S};\n              radius: ${o};\n              angle: ${m};\n            `},e("a-entity",{id:`${s}-title`,text:`\n                value: ${THREE.Math.radToDeg(m).toFixed(d.angleUnitsDecimalPlaces)+" deg"};\n                side: double;\n                align: center;\n                baseline: bottom;\n                anchor: center;\n                width: ${d.fontSizeSmall*this._boundingSphereRadius}\n              `,position:h.vector3ToString(v.clone().add(T)),visible:`${this.selected===s}`,"al-look-to-camera":!0,"al-render-overlaid":!0}))}})}_renderLights(){return[e("a-entity",{id:"light-1",light:"type: directional; color: #ffffff; intensity: 0.75",position:"1 1 1"}),e("a-entity",{id:"light-2",light:"type: directional; color: #002958; intensity: 0.5",position:"-1 -1 -1"}),e("a-entity",{id:"light-3",light:"type: ambient; color: #d0d0d0; intensity: 1"})]}_renderCamera(){return e("a-camera",{fov:d.cameraValues.fov,near:d.cameraValues.near,"look-controls":"enabled: false",far:d.cameraValues.far,id:"mainCamera",cursor:"rayOrigin: mouse",raycaster:"objects: .collidable;","al-orbit-control":`\n          maxPolarAngle: ${d.cameraValues.maxPolarAngle};\n          minDistance: ${d.cameraValues.minDistance};\n          screenSpacePanning: true;\n          rotateSpeed: ${d.cameraValues.rotateSpeed};\n          zoomSpeed: ${d.cameraValues.zoomSpeed};\n          enableDamping: true;\n          dampingFactor: ${d.cameraValues.dampingFactor};\n          controlTarget: ${h.vector3ToString(this.camera?this.camera.target:new THREE.Vector3(0,0,0))};\n          controlPosition: ${h.vector3ToString(this.camera?this.camera.position:new THREE.Vector3(0,0,0))};\n          enabled: ${this.controlsEnabled};\n          animating: ${!(!this.camera||!this.camera.animating)&&this.camera.animating}\n        `,ref:e=>this._camera=e})}_renderScene(){return e("a-scene",{embedded:!0,renderer:`\n          colorManagement: true;\n          sortObjects: true;\n          webgl2: ${this._isWebGl2};\n          antialias: true;\n        `,"vr-mode-ui":"enabled: false",ref:e=>this._scene=e},this._renderBoundingBox(),this._renderSrc(),this._renderNodes(),this._renderEdges(),this._renderAngles(),this._renderLights(),this._renderCamera())}render(){return e("div",{id:"al-container",style:{width:E.addCssUnits(this.width),height:E.addCssUnits(this.height)}},e("div",{id:"lut-container"},e("div",{id:"lut-min"},"0.0"),e("div",{id:"lut-canvases"}),e("div",{id:"lut-max"},"1.0")),this._renderScene(),this._renderSpinner())}_resize(){this._scene&&this._scene.resize()}_createEdge(e,t){if(Array.from(this.edges).find(([s,n])=>n.node1Id===e&&n.node2Id===t||n.node1Id===t&&n.node2Id===e))console.log("edge already exists");else{const s={node1Id:e,node2Id:t},n=b.getNextId(a.EDGE,this.edges);this._setEdge([n,s])}}_createAngle(e,t){if(Array.from(this.angles).find(([s,n])=>n.edge1Id===e&&n.edge2Id===t||n.edge1Id===t&&n.edge2Id===e))console.warn("cannot create angle: angle already exists");else{let s=this.edges.get(e),n=this.edges.get(t);if(s.node1Id===n.node1Id||s.node1Id==n.node2Id||s.node2Id==n.node1Id||s.node2Id===n.node2Id){const s={edge1Id:e,edge2Id:t},n=b.getNextId(a.ANGLE,this.angles);this._setAngle([n,s])}else console.warn("cannot create angle: edges not connected")}}_stateChanged(){this.changed.emit(this.store.getState().app)}_setGraph(e){e.nodes&&new Map(e.nodes).forEach((e,t)=>{this.appSetNode([t,e])}),e.edges&&new Map(e.edges).forEach((e,t)=>{this.appSetEdge([t,e])}),e.angles&&new Map(e.angles).forEach((e,t)=>{this.appSetAngle([t,e])}),this._stateChanged()}_clearGraph(){this.appClearNodes(),this.appClearEdges(),this.appClearAngles(),this._stateChanged()}_deleteNode(e){this.appDeleteNode(e),this._stateChanged()}_setNode(e){this.appSetNode(e),this._stateChanged()}_selectNode(e,t=!1){if(t&&e!==this.selected){let t={position:this.camera.position.clone(),target:this.camera.target.clone()},s={position:new THREE.Vector3(-1,-1,-1),target:this.camera.target.clone()},n=E.getCameraPositionFromNode(this.nodes.get(e),this._boundingSphereRadius,this.camera.target);if(n){const i=n.distanceTo(this.camera.position);if(i>0){s.position.copy(n.clone());const a=h.getSlerpPath(t,s,i>0,!1);this._scene.emit(C.ANIMATION_STARTED,{slerpPath:a},!1),this.appSetCamera({animating:!0}),this.appSelectNode(e),this._stateChanged()}}}else this.appSelectNode(e),this._stateChanged()}_setEdge(e){this.appSetEdge(e),this._stateChanged()}_deleteEdge(e){this.appDeleteEdge(e),this._stateChanged()}_selectEdge(e){this.appSelectEdge(e),this._stateChanged()}_setAngle(e){this.appSetAngle(e),this._stateChanged()}_selectAngle(e){this.appSelectAngle(e),this._stateChanged()}_deleteAngle(e){this.appDeleteAngle(e),this._stateChanged()}_setGraphEnabled(e){this.appSetGraphEnabled(e),this._stateChanged()}_setBoundingBoxEnabled(e){this.appSetBoundingBoxEnabled(e),this._stateChanged()}_setSlicesIndex(e){this.appSetSlicesIndex(e),this._stateChanged()}_setOrientation(e){this.appSetOrientation(e),this._stateChanged()}_setSlicesWindowCenter(e){this.appSetSlicesWindowCenter(e),this._stateChanged()}_setSlicesWindowWidth(e){this.appSetSlicesWindowWidth(e),this._stateChanged()}_setVolumeSteps(e){this.appSetVolumeSteps(e),this._stateChanged()}_setVolumeWindowCenter(e){this.appSetVolumeWindowCenter(e),this._stateChanged()}_setVolumeWindowWidth(e){this.appSetVolumeWindowWidth(e),this._stateChanged()}_setDisplayMode(e){this.appSetDisplayMode(e),this._stateChanged()}_setSrc(e){this.appSetSrc(e),this._stateChanged()}_srcLoaded(e){const s=this._targetEntity.object3DMap.mesh;switch(this.displayMode){case t.MESH:this._mesh=s,this._stackhelper=null;break;case t.SLICES:this._mesh=e.detail._bBox._mesh,this._stackhelper=null;break;case t.VOLUME:this._mesh=e.detail._mesh,this._stackhelper=e.detail}this._mesh.geometry.computeBoundingSphere(),this._boundingSphereRadius=this._mesh.geometry.boundingSphere.radius,this._boundingBox=E.getBoundingBox(this._mesh);let n=E.getCameraStateFromMesh(this._mesh);n&&this.appSetCamera(n),this.appSetSrcLoaded(!0),this._stateChanged(),this.loaded.emit(e.detail)}_keyDownHandler(e){this._isShiftDown=e.shiftKey,e.keyCode===n.Delete&&this.selected&&(this.nodes.has(this.selected)?this._deleteNode(this.selected):this.edges.has(this.selected)?this._deleteEdge(this.selected):this.angles.has(this.selected)&&this._deleteAngle(this.selected))}_keyUpHandler(e){this._isShiftDown=!1}_graphEntryPointerUpHandler(e){this.appSetControlsEnabled(!0),h.enableOrbitControls(this._camera,!0)}_graphEntryPointerDownHandler(e){this.appSetControlsEnabled(!1),h.enableOrbitControls(this._camera,!1)}_graphEntryPointerOutHandler(e){this._hovered=null}_graphEntryPointerOverHandler(e){this._hovered=e.detail.id}_controlsInteractionHandler(e){}_controlsInteractionFinishedHandler(e){this._debouncedAppSetCamera(e.detail.cameraState)}_spawnNodeHandler(e){if(this.graphEnabled&&this._validTarget&&null===this._hovered){let s=e.detail.aframeEvent.detail.intersection;const n=b.getNextId(a.NODE,this.nodes);let i;if(this.displayMode===t.VOLUME&&s){let e=new THREE.Vector3,t=new THREE.Vector3;p.volumeRay(this._stackhelper,this._camera.object3D.children[0].position.clone(),this._camera.getAttribute("raycaster").direction,d.cameraValues.far,e,t)&&(i={position:h.vector3ToString(e),scale:this._boundingSphereRadius/d.nodeSizeRatio,title:n})}else s&&(i={targetId:"0",position:h.vector3ToString(s.point),scale:this._boundingSphereRadius/d.nodeSizeRatio,title:n});if(i){const e=this.selected;this._setNode([n,i]),this._isShiftDown&&this.nodes.has(e)&&(this._createEdge(e,n),this._selectNode(n))}}}_graphEntryValidTargetHandler(e){this._validTarget=e.detail.valid}_controlsAnimationFinishedHandler(e){this.appSetCamera({animating:!1})}_graphEntrySelectedHandler(e){if(!this.graphEnabled)return;const t=e.detail.id;switch(e.detail.type){case a.NODE:null!==this._hovered&&this.nodes.has(this._hovered)&&null!==this.selected&&this.nodes.has(this.selected)&&this.selected!==this._hovered&&this._isShiftDown&&this._createEdge(this.selected,this._hovered),this._selectNode(t);break;case a.EDGE:null!==this._hovered&&this.edges.has(this._hovered)&&null!==this.selected&&this.edges.has(this.selected)&&this.selected!==this._hovered&&this._isShiftDown&&this._createAngle(this.selected,this._hovered),this._selectEdge(t);break;case a.ANGLE:this._selectAngle(t)}}_graphEntryDraggedHandler(e){const s=e.detail.id,n=this._camera.components.raycaster,i=this._camera.getAttribute("raycaster");let a,r=new THREE.Vector3,o=!1,l=this._camera.object3D.children[0].position;if(this.displayMode===t.VOLUME){if(a=n.getIntersection(this._boundingEntity)){let e=new THREE.Vector3;p.volumeRay(this._stackhelper,l.clone(),i.direction,d.cameraValues.far,r,e)&&(o=!0)}}else(a=n.getIntersection(this._targetEntity))&&(r.copy(a.point),o=!0);if(!o){let e=l.distanceTo(this._targetEntity.getAttribute("position"));r.copy(l),r.add(i.direction.clone().multiplyScalar(1.5*e))}this._setNode([s,{position:h.vector3ToString(r)}]),this._scene.emit(s+d.movedEventName,{},!0)}_addEventListeners(){window.addEventListener("keydown",this._keyDownHandler,!1),window.addEventListener("keyup",this._keyUpHandler,!1),this._scene.addEventListener(C.ANIMATION_FINISHED,this._controlsAnimationFinishedHandler,!1),this._scene.addEventListener(C.INTERACTION,this._controlsInteractionHandler,!1),this._scene.addEventListener(C.INTERACTION_FINISHED,this._controlsInteractionFinishedHandler,!1),this._scene.addEventListener(g.POINTER_UP,this._graphEntryPointerUpHandler,!1),this._scene.addEventListener(g.POINTER_DOWN,this._graphEntryPointerDownHandler,!1),this._scene.addEventListener(g.DRAGGED,this._graphEntryDraggedHandler,!1),this._scene.addEventListener(g.SELECTED,this._graphEntrySelectedHandler,!1),this._scene.addEventListener(D.ADD_NODE,this._spawnNodeHandler,!1),this._scene.addEventListener(D.VALID_TARGET,this._graphEntryValidTargetHandler,!1),this._scene.addEventListener(w.LOADED,this._srcLoaded,!1),this._scene.addEventListener(W.LOADED,this._srcLoaded,!1),this._scene.addEventListener(g.POINTER_OVER,this._graphEntryPointerOverHandler,!1),this._scene.addEventListener(g.POINTER_OUT,this._graphEntryPointerOutHandler,!1)}componentDidLoad(){}componentDidUpdate(){this._scene&&this._addEventListeners()}static get is(){return"uv-aleph"}static get properties(){return{angles:{state:!0},boundingBoxEnabled:{state:!0},camera:{state:!0},clearGraph:{method:!0},controlsEnabled:{state:!0},deleteAngle:{method:!0},deleteEdge:{method:!0},deleteNode:{method:!0},displayMode:{state:!0},dracoDecoderPath:{type:String,attr:"draco-decoder-path"},edges:{state:!0},graphEnabled:{state:!0},height:{type:String,attr:"height"},load:{method:!0},nodes:{state:!0},nodesVisible:{state:!0},optionsEnabled:{state:!0},optionsVisible:{state:!0},orientation:{state:!0},resize:{method:!0},selected:{state:!0},selectNode:{method:!0},setBoundingBoxEnabled:{method:!0},setDisplayMode:{method:!0},setEdge:{method:!0},setGraph:{method:!0},setGraphEnabled:{method:!0},setNode:{method:!0},setOrientation:{method:!0},setSlicesIndex:{method:!0},setSlicesWindowCenter:{method:!0},setSlicesWindowWidth:{method:!0},setVolumeSteps:{method:!0},setVolumeWindowCenter:{method:!0},setVolumeWindowWidth:{method:!0},slicesIndex:{state:!0},slicesWindowCenter:{state:!0},slicesWindowWidth:{state:!0},src:{state:!0},srcLoaded:{state:!0},store:{context:"store"},volumeSteps:{state:!0},volumeWindowCenter:{state:!0},volumeWindowWidth:{state:!0},width:{type:String,attr:"width"}}}static get events(){return[{name:"changed",method:"changed",bubbles:!0,cancelable:!0,composed:!0},{name:"loaded",method:"loaded",bubbles:!0,cancelable:!0,composed:!0}]}static get style(){return"#al-container{position:relative;font-family:sans-serif}#al-container a-scene{background-color:var(--viewport-background-color);display:block;width:100%;height:100%}#al-container #lut-container{display:none}#al-container .progress.container{position:absolute;top:auto!important;bottom:0!important}#al-container .progress.container .load.progress,#al-container .progress.container .parse.progress{border:none!important;height:4px!important;background-color:var(--load-progress-color,#fff)!important}#spinner{position:absolute;left:50%;top:50%}#spinner .square{margin:0 0 0 -15px;background-color:var(--spinner-color,#fff);width:30px;height:30px;-webkit-animation:sk-rotateplane 1.2s ease-in-out infinite;-moz-animation:sk-rotateplane 1.2s infinite ease-in-out;animation:sk-rotateplane 1.2s ease-in-out infinite}\@-webkit-keyframes sk-rotateplane{0%{-webkit-transform:perspective(120px)}50%{-webkit-transform:perspective(120px) rotateY(180deg)}to{-webkit-transform:perspective(120px) rotateY(180deg) rotateX(180deg)}}\@keyframes sk-rotateplane{0%{transform:perspective(120px) rotateX(0deg) rotateY(0deg);-webkit-transform:perspective(120px) rotateX(0deg) rotateY(0deg)}50%{transform:perspective(120px) rotateX(-180.1deg) rotateY(0deg);-webkit-transform:perspective(120px) rotateX(-180.1deg) rotateY(0deg)}to{transform:perspective(120px) rotateX(-180deg) rotateY(-179.9deg);-webkit-transform:perspective(120px) rotateX(-180deg) rotateY(-179.9deg)}}"}}export{ye as UvAleph};