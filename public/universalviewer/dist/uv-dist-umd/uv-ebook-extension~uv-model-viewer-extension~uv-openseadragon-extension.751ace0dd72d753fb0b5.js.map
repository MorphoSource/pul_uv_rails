{"version":3,"sources":["webpack://UV/./src/modules/uv-dialogues-module/DownloadDialogue.ts","webpack://UV/./src/modules/uv-dialogues-module/MoreInfoDialogue.ts","webpack://UV/./src/modules/uv-shared-module/DownloadOption.ts"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAAiB,SAAI,IAAI,SAAI;AAC7B;AACA;AACA,cAAc,gBAAgB,sCAAsC,iBAAiB,EAAE;AACvF,6BAA6B,uDAAuD;AACpF;AACA;AACA;AACA;AACA,uBAAuB,sBAAsB;AAC7C;AACA;AACA,CAAC;AAC2D;AACJ;AACY;AACd;AACX;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,uEAAU;AACrC,4BAA4B,uEAAU;AACtC;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCAAoC,uEAAU;AAC9C,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,2CAA2C,+EAAc;AACzD;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,uBAAuB;AAClD;AACA;AACA;AACA;AACA;AACA;AACA,+DAA+D,wDAAW;AAC1E;AACA;AACA;AACA;AACA;AACA,+BAA+B,wBAAwB;AACvD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB,mDAAK;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB,uBAAuB;AAC9C;AACA;AACA,4BAA4B,wDAAW;AACvC;AACA;AACA,iCAAiC,EAAE;AACnC;AACA;AACA;AACA;AACA,2BAA2B,mDAAK;AAChC,wBAAwB,qDAAO;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY,mDAAK;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,+EAAc;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,CAAC,mEAAQ;AACkB;;;;;;;;;;;;;ACjN5B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAAiB,SAAI,IAAI,SAAI;AAC7B;AACA;AACA,cAAc,gBAAgB,sCAAsC,iBAAiB,EAAE;AACvF,6BAA6B,uDAAuD;AACpF;AACA;AACA;AACA;AACA,uBAAuB,sBAAsB;AAC7C;AACA;AACA,CAAC;AAC2D;AACJ;AACjB;AACD;AACuC;AAC7E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,uEAAU;AACrC,4BAA4B,uEAAU;AACtC;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qCAAqC,+EAAiB;AACtD;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCAAoC,mDAAK;AACzC;AACA;AACA;AACA,uBAAuB,uEAAS;AAChC;AACA;AACA;AACA;AACA;AACA,uBAAuB,uDAAQ;AAC/B,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,CAAC,mEAAQ;AACkB;;;;;;;;;;;;;ACnF5B;AAAA;AAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,wCAAwC","file":"uv-ebook-extension~uv-model-viewer-extension~uv-openseadragon-extension.751ace0dd72d753fb0b5.js","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { BaseEvents } from \"../uv-shared-module/BaseEvents\";\nimport { Dialogue } from \"../uv-shared-module/Dialogue\";\nimport { DownloadOption } from \"../uv-shared-module/DownloadOption\";\nimport { Bools, Files, Strings } from \"@edsilv/utils\";\nimport { LanguageMap } from \"manifesto.js\";\nvar DownloadDialogue = /** @class */ (function (_super) {\n    __extends(DownloadDialogue, _super);\n    function DownloadDialogue($element) {\n        return _super.call(this, $element) || this;\n    }\n    DownloadDialogue.prototype.create = function () {\n        var _this = this;\n        this.setConfig(\"downloadDialogue\");\n        _super.prototype.create.call(this);\n        this.openCommand = BaseEvents.SHOW_DOWNLOAD_DIALOGUE;\n        this.closeCommand = BaseEvents.HIDE_DOWNLOAD_DIALOGUE;\n        this.component.subscribe(this.openCommand, function (triggerButton) {\n            _this.open(triggerButton);\n        });\n        this.component.subscribe(this.closeCommand, function () {\n            _this.close();\n        });\n        // create ui.\n        this.$title = $(\"<h1>\" + this.content.title + \"</h1>\");\n        this.$content.append(this.$title);\n        this.$noneAvailable = $('<div class=\"noneAvailable\">' + this.content.noneAvailable + \"</div>\");\n        this.$content.append(this.$noneAvailable);\n        this.$downloadOptions = $('<ol class=\"options\"></ol>');\n        this.$content.append(this.$downloadOptions);\n        this.$footer = $('<div class=\"footer\"></div>');\n        this.$content.append(this.$footer);\n        this.$termsOfUseButton = $('<a href=\"#\">' + this.extension.data.config.content.termsOfUse + \"</a>\");\n        this.$footer.append(this.$termsOfUseButton);\n        this.$termsOfUseButton.onPressed(function () {\n            _this.component.publish(BaseEvents.SHOW_TERMS_OF_USE);\n        });\n        // hide\n        this.$element.hide();\n        this.updateTermsOfUseButton();\n    };\n    DownloadDialogue.prototype.addEntireFileDownloadOptions = function () {\n        if (this.isDownloadOptionAvailable(DownloadOption.ENTIRE_FILE_AS_ORIGINAL)) {\n            this.$downloadOptions.empty();\n            //\n            // add each file src\n            var canvas = this.extension.helper.getCurrentCanvas();\n            var renderingFound = false;\n            var renderings = canvas.getRenderings();\n            for (var i = 0; i < renderings.length; i++) {\n                var rendering = renderings[i];\n                var renderingFormat = rendering.getFormat();\n                var format = \"\";\n                if (renderingFormat) {\n                    format = renderingFormat.toString();\n                }\n                this.addEntireFileDownloadOption(rendering.id, LanguageMap.getValue(rendering.getLabel()), format);\n                renderingFound = true;\n            }\n            if (!renderingFound) {\n                var annotationFound = false;\n                var annotations = canvas.getContent();\n                for (var i = 0; i < annotations.length; i++) {\n                    var annotation = annotations[i];\n                    var body = annotation.getBody();\n                    if (body.length) {\n                        var format = body[0].getFormat();\n                        if (format) {\n                            this.addEntireFileDownloadOption(body[0].id, \"\", format.toString());\n                            annotationFound = true;\n                        }\n                    }\n                }\n                if (!annotationFound) {\n                    this.addEntireFileDownloadOption(canvas.id, \"\", \"\");\n                }\n            }\n        }\n    };\n    DownloadDialogue.prototype.addEntireFileDownloadOption = function (uri, label, format) {\n        var fileType;\n        if (format) {\n            fileType = Files.simplifyMimeType(format);\n        }\n        else {\n            fileType = this.getFileExtension(uri);\n        }\n        if (!label) {\n            label = this.content.entireFileAsOriginal;\n        }\n        if (fileType) {\n            label += \" (\" + fileType + \")\";\n        }\n        this.$downloadOptions.append('<li><a href=\"' +\n            uri +\n            '\" target=\"_blank\" download tabindex=\"0\">' +\n            label +\n            \"</li>\");\n    };\n    DownloadDialogue.prototype.resetDynamicDownloadOptions = function () {\n        this.renderingUrls = [];\n        this.renderingUrlsCount = 0;\n        this.$downloadOptions.find(\"li.dynamic\").remove();\n    };\n    DownloadDialogue.prototype.getDownloadOptionsForRenderings = function (resource, defaultLabel, type) {\n        var renderings = resource.getRenderings();\n        var downloadOptions = [];\n        for (var i = 0; i < renderings.length; i++) {\n            var rendering = renderings[i];\n            if (rendering) {\n                var label = LanguageMap.getValue(rendering.getLabel(), this.extension.getLocale());\n                var currentId = \"downloadOption\" + ++this.renderingUrlsCount;\n                if (label) {\n                    label += \" ({0})\";\n                }\n                else {\n                    label = defaultLabel;\n                }\n                var mime = Files.simplifyMimeType(rendering.getFormat().toString());\n                label = Strings.format(label, mime);\n                this.renderingUrls[currentId] = rendering.id;\n                var $button = $('<li class=\"option dynamic\"><input id=\"' +\n                    currentId +\n                    '\" data-mime=\"' +\n                    mime +\n                    '\" title=\"' +\n                    label +\n                    '\" type=\"radio\" name=\"downloadOptions\" tabindex=\"0\" /><label for=\"' +\n                    currentId +\n                    '\">' +\n                    label +\n                    \"</label></li>\");\n                downloadOptions.push({\n                    type: type,\n                    button: $button\n                });\n            }\n        }\n        return downloadOptions;\n    };\n    DownloadDialogue.prototype.getSelectedOption = function () {\n        return this.$downloadOptions.find(\"li.option input:checked\");\n    };\n    DownloadDialogue.prototype.getCurrentResourceId = function () {\n        var canvas = this.extension.helper.getCurrentCanvas();\n        return canvas.externalResource.data.id;\n    };\n    DownloadDialogue.prototype.getCurrentResourceFormat = function () {\n        var id = this.getCurrentResourceId();\n        return id.substr(id.lastIndexOf(\".\") + 1).toLowerCase();\n    };\n    DownloadDialogue.prototype.updateNoneAvailable = function () {\n        if (!this.$downloadOptions.find(\"li:visible\").length) {\n            this.$noneAvailable.show();\n        }\n        else {\n            // select first option.\n            this.$noneAvailable.hide();\n        }\n    };\n    DownloadDialogue.prototype.updateTermsOfUseButton = function () {\n        var requiredStatement = this.extension.helper.getRequiredStatement();\n        if (Bools.getBool(this.extension.data.config.options.termsOfUseEnabled, false) &&\n            requiredStatement &&\n            requiredStatement.value) {\n            this.$termsOfUseButton.show();\n        }\n        else {\n            this.$termsOfUseButton.hide();\n        }\n    };\n    DownloadDialogue.prototype.getFileExtension = function (fileUri) {\n        var extension = fileUri.split(\".\").pop();\n        // if it's not a valid file extension\n        if (extension.length > 5 || extension.indexOf(\"/\") !== -1) {\n            return null;\n        }\n        return extension;\n    };\n    DownloadDialogue.prototype.isMediaDownloadEnabled = function () {\n        return this.extension.helper.isUIEnabled(\"mediaDownload\");\n    };\n    DownloadDialogue.prototype.isDownloadOptionAvailable = function (option) {\n        switch (option) {\n            case DownloadOption.ENTIRE_FILE_AS_ORIGINAL:\n                return this.isMediaDownloadEnabled();\n        }\n        return true;\n    };\n    DownloadDialogue.prototype.close = function () {\n        _super.prototype.close.call(this);\n    };\n    DownloadDialogue.prototype.resize = function () {\n        this.setDockedPosition();\n    };\n    return DownloadDialogue;\n}(Dialogue));\nexport { DownloadDialogue };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { BaseEvents } from \"../uv-shared-module/BaseEvents\";\nimport { Dialogue } from \"../uv-shared-module/Dialogue\";\nimport { sanitize } from \"../../Utils\";\nimport { Bools } from \"@edsilv/utils\";\nimport { MetadataComponent, LimitType } from \"@iiif/iiif-metadata-component\";\nvar MoreInfoDialogue = /** @class */ (function (_super) {\n    __extends(MoreInfoDialogue, _super);\n    function MoreInfoDialogue($element) {\n        return _super.call(this, $element) || this;\n    }\n    MoreInfoDialogue.prototype.create = function () {\n        var _this = this;\n        this.setConfig(\"moreInfoDialogue\");\n        _super.prototype.create.call(this);\n        this.openCommand = BaseEvents.SHOW_MOREINFO_DIALOGUE;\n        this.closeCommand = BaseEvents.HIDE_MOREINFO_DIALOGUE;\n        this.component.subscribe(this.openCommand, function (triggerButton) {\n            _this.open(triggerButton);\n        });\n        this.component.subscribe(this.closeCommand, function () {\n            _this.close();\n        });\n        this.config.content = this.extension.data.config.modules.moreInfoRightPanel.content;\n        this.config.options = this.extension.data.config.modules.moreInfoRightPanel.options;\n        // create ui\n        this.$title = $(\"<h1>\" + this.config.content.title + \"</h1>\");\n        this.$content.append(this.$title);\n        this.$metadata = $('<div class=\"iiif-metadata-component\"></div>');\n        this.$content.append(this.$metadata);\n        this.metadataComponent = new MetadataComponent({\n            target: this.$metadata[0]\n        });\n        // hide\n        this.$element.hide();\n    };\n    MoreInfoDialogue.prototype.open = function (triggerButton) {\n        _super.prototype.open.call(this, triggerButton);\n        this.metadataComponent.set(this._getData());\n    };\n    MoreInfoDialogue.prototype._getData = function () {\n        return {\n            canvasDisplayOrder: this.config.options.canvasDisplayOrder,\n            canvases: this.extension.getCurrentCanvases(),\n            canvasExclude: this.config.options.canvasExclude,\n            canvasLabels: this.extension.getCanvasLabels(this.content.page),\n            content: this.config.content,\n            copiedMessageDuration: 2000,\n            copyToClipboardEnabled: Bools.getBool(this.config.options.copyToClipboardEnabled, false),\n            helper: this.extension.helper,\n            licenseFormatter: null,\n            limit: this.config.options.textLimit || 4,\n            limitType: LimitType.LINES,\n            manifestDisplayOrder: this.config.options.manifestDisplayOrder,\n            manifestExclude: this.config.options.manifestExclude,\n            range: this.extension.getCurrentCanvasRange(),\n            rtlLanguageCodes: this.config.options.rtlLanguageCodes,\n            sanitizer: function (html) {\n                return sanitize(html);\n            },\n            showAllLanguages: this.config.options.showAllLanguages\n        };\n    };\n    MoreInfoDialogue.prototype.close = function () {\n        _super.prototype.close.call(this);\n    };\n    MoreInfoDialogue.prototype.resize = function () {\n        this.setDockedPosition();\n    };\n    return MoreInfoDialogue;\n}(Dialogue));\nexport { MoreInfoDialogue };\n","export var DownloadOption;\n(function (DownloadOption) {\n    DownloadOption[\"CANVAS_RENDERINGS\"] = \"canvasRenderings\";\n    DownloadOption[\"CURRENT_VIEW\"] = \"currentView\";\n    DownloadOption[\"ENTIRE_DOCUMENT_AS_PDF\"] = \"entireDocumentAsPdf\";\n    DownloadOption[\"ENTIRE_DOCUMENT_AS_TEXT\"] = \"entireDocumentAsText\";\n    DownloadOption[\"ENTIRE_FILE_AS_ORIGINAL\"] = \"entireFileAsOriginal\";\n    DownloadOption[\"IMAGE_RENDERINGS\"] = \"imageRenderings\";\n    DownloadOption[\"MANIFEST_RENDERINGS\"] = \"manifestRenderings\";\n    DownloadOption[\"RANGE_RENDERINGS\"] = \"rangeRenderings\";\n    DownloadOption[\"SELECTION\"] = \"selection\";\n    //SEQUENCE_RENDERINGS = \"sequenceRenderings\",\n    DownloadOption[\"UNKNOWN\"] = \"unknown\";\n    DownloadOption[\"WHOLE_IMAGE_HIGH_RES\"] = \"wholeImageHighRes\";\n    DownloadOption[\"WHOLE_IMAGE_LOW_RES\"] = \"wholeImageLowRes\";\n    DownloadOption[\"WHOLE_IMAGES_HIGH_RES\"] = \"wholeImagesHighRes\";\n})(DownloadOption || (DownloadOption = {}));\n"],"sourceRoot":""}